# æ¸¸æˆæœåŠ¡å™¨å¼€å‘è¿›åº¦æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: postapocgameï¼ˆåå¯ç¤ºå½•æ¸¸æˆï¼‰  
**æœåŠ¡ç«¯**: Golang  
**å®¢æˆ·ç«¯**: Godotï¼ˆè®¡åˆ’ï¼‰  
**æ¸¸æˆç±»å‹**: ä»¿2Dæ¨ªç‰ˆæ ¼æ–—DNFæ¸¸æˆ  
**ç›®æ ‡å¹³å°**: Windowsã€å®‰å“ã€iOS  
**æ•°æ®åº“**: SQLite + GORM  
**å¼€å‘æ¨¡å¼**: ä¸ªäººå¼€å‘

### æœåŠ¡å™¨æ¶æ„

- **Gateway**: ç½‘å…³æœåŠ¡å™¨ï¼Œå¤„ç†å®¢æˆ·ç«¯è¿æ¥
- **GameServer**: æ¸¸æˆæœåŠ¡å™¨ï¼Œä½¿ç”¨**ä¸€ä¸ªç©å®¶ä¸€ä¸ªActor**æ¨¡å‹ï¼Œå¤„ç†éå‰¯æœ¬ä¸šåŠ¡ï¼ˆå®Œæˆä»»åŠ¡ã€è´­ä¹°å•†åº—ã€èƒŒåŒ…ã€è£…å¤‡ç­‰ï¼‰
- **DungeonServer**: å‰¯æœ¬æœåŠ¡å™¨ï¼Œä½¿ç”¨**å•Actoræ¨¡å‹**ï¼Œæ— é”åŒ–å¤„ç†å‰¯æœ¬ä¸šåŠ¡ï¼ˆæˆ˜æ–—ã€ç§»åŠ¨ç­‰ï¼‰

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

### Phase 1: åŸºç¡€æ•°æ®ï¼ˆå·²å®Œæˆï¼‰âœ…

#### 1.1 æ•°æ®åº“è®¾è®¡ä¸ORMé›†æˆ âœ…
- **æ•°æ®åº“**: SQLite + GORM
- **æ•°æ®è¡¨**:
  - `Account`: è´¦å·è¡¨ï¼ˆIDã€ç”¨æˆ·åã€å¯†ç hashã€åˆ›å»ºæ—¶é—´ï¼‰
  - `Player`: è§’è‰²è¡¨ï¼ˆIDã€è´¦å·IDã€è§’è‰²åã€èŒä¸šã€æ€§åˆ«ã€ç­‰çº§ã€BinaryDataäºŒè¿›åˆ¶æ•°æ®ï¼‰
  - **æ³¨æ„**: `PlayerBag`ã€`PlayerEquip`ã€`PlayerMoney`ã€`PlayerDungeon`ç­‰è¡¨å·²ç§»é™¤ï¼Œæ‰€æœ‰ç³»ç»Ÿæ•°æ®ç»Ÿä¸€å­˜å‚¨åœ¨`Player.BinaryData`å­—æ®µä¸­ï¼ˆprotobufåºåˆ—åŒ–çš„`PlayerRoleBinaryData`ï¼‰
- **ä½ç½®**: `server/internal/database/`
- **åˆå§‹åŒ–**: `server/service/gameserver/main.go` ä¸­è‡ªåŠ¨åˆå§‹åŒ–æ•°æ®åº“å’Œè¡¨è¿ç§»

#### 1.2 è´¦å·æ³¨å†Œ/ç™»å½•ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - è´¦å·æ³¨å†Œï¼ˆç”¨æˆ·å3-32å­—ç¬¦ï¼Œå¯†ç è‡³å°‘6å­—ç¬¦ï¼‰
  - è´¦å·ç™»å½•ï¼ˆbcryptå¯†ç éªŒè¯ï¼‰
  - Tokenç”Ÿæˆå’ŒSessionç®¡ç†
- **åè®®**: 
  - `C2SRegister` / `S2CRegisterResult`
  - `C2SLogin` / `S2CLoginResult`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entity/player_network.go`
- **Sessionæ‰©å±•**: `server/internal/argsdef/session.go`ï¼ˆæ·»åŠ AccountIDå’ŒTokenå­—æ®µï¼‰

#### 1.3 è§’è‰²å¢åˆ æ”¹æŸ¥æŒä¹…åŒ– âœ…
- **åŠŸèƒ½**:
  - è§’è‰²åˆ›å»ºï¼ˆè§’è‰²åæŸ¥é‡ã€æ¯ä¸ªè´¦å·æœ€å¤š3ä¸ªè§’è‰²ï¼‰
  - è§’è‰²åˆ—è¡¨æŸ¥è¯¢ï¼ˆä»æ•°æ®åº“è¯»å–ï¼‰
  - è¿›å…¥æ¸¸æˆï¼ˆä»æ•°æ®åº“åŠ è½½è§’è‰²æ•°æ®ï¼‰
- **åè®®**: 
  - `C2SQueryRoles` / `S2CRoleList`
  - `C2SCreateRole` / `S2CCreateRoleResult`
  - `C2SEnterGame` / `S2CLoginSuccess`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entity/player_network.go`

#### 1.4 é…ç½®è¡¨åŠ è½½ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**: JSONé…ç½®çƒ­åŠ è½½
- **æ”¯æŒé…ç½®**: ç‰©å“ã€ç­‰çº§ã€VIPã€è´§å¸ã€ä»»åŠ¡ã€é‚®ä»¶ã€æ€ªç‰©ã€æŠ€èƒ½ã€Buffã€æ¶ˆè€—ã€å¥–åŠ±ã€èŒä¸šã€åœºæ™¯ã€NPCã€ä¼ é€ç‚¹ã€æ¯æ—¥ä»»åŠ¡ã€æˆå°±ã€è£…å¤‡ç²¾ç‚¼/é™„é­”/å¥—è£…ç­‰
- **ä½ç½®**: `server/internal/jsonconf/config_manager.go`
- **é…ç½®è·¯å¾„**: `server/output/config/`
- **é…ç½®æ–‡ä»¶**: æ‰€æœ‰é…ç½®ç»“æ„éƒ½æœ‰å¯¹åº”çš„JSONæ–‡ä»¶ï¼ˆå…±26ä¸ªé…ç½®æ–‡ä»¶ï¼‰
- **ä¿®å¤**: ä¿®å¤äº†é…ç½®æ–‡ä»¶åç§°ä¸åŒ¹é…é—®é¢˜ï¼Œç¡®ä¿æ‰€æœ‰é…ç½®æ–‡ä»¶éƒ½èƒ½æ­£ç¡®åŠ è½½ï¼ˆitemconfig.jsonã€levelconfig.jsonã€vipconfig.jsonã€moneyconfig.jsonã€questconfig.jsonã€mailtemplateconfig.jsonã€monsterconfig.jsonã€skillconfig.jsonã€buffconfig.jsonï¼‰

---

### Phase 2: æ ¸å¿ƒç©æ³•ï¼ˆå·²å®Œæˆï¼‰âœ…

#### 2.1 ç©å®¶ç³»ç»Ÿï¼ˆGameServerï¼‰

##### 2.1.1 èƒŒåŒ…ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - ç‰©å“æ·»åŠ /åˆ é™¤ï¼ˆæ”¯æŒå †å ï¼‰
  - èƒŒåŒ…å®¹é‡ç®¡ç†ï¼ˆé»˜è®¤100æ ¼ï¼‰
  - æ•°æ®å­˜å‚¨åœ¨`PlayerRoleBinaryData.bag_data`ä¸­
  - ç‰©å“ç»‘å®šçŠ¶æ€ç®¡ç†
  - äº‹åŠ¡æ”¯æŒï¼ˆæ¶ˆè€—/å¥–åŠ±ï¼‰
- **ç³»ç»Ÿ**: `BagSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/bag_sys.go`
- **æ•°æ®å­˜å‚¨**: `PlayerRoleBinaryData.bag_data`ï¼ˆ`SiBagData`ï¼‰
- **äº‹ä»¶**: `OnItemAdd`, `OnItemRemove`

##### 2.1.2 è£…å¤‡ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - è£…å¤‡ç©¿è„±ï¼ˆè‡ªåŠ¨å¤„ç†èƒŒåŒ…äº¤äº’ï¼‰
  - è£…å¤‡å¼ºåŒ–ï¼ˆæŒ‰ç­‰çº§é…ç½®æ¶ˆè€—ï¼Œä½¿ç”¨ä¸‡åˆ†æ¯”è®¡ç®—ï¼‰
  - è£…å¤‡ç²¾ç‚¼ï¼ˆæ¶ˆè€—ææ–™æå‡ç²¾ç‚¼ç­‰çº§ï¼Œæ¯çº§+5%å±æ€§ï¼‰
  - è£…å¤‡é™„é­”ï¼ˆæ·»åŠ ç‰¹æ®Šå±æ€§ï¼‰
  - è£…å¤‡å¥—è£…æ•ˆæœï¼ˆå¤šä»¶è£…å¤‡ç»„åˆè§¦å‘æ•ˆæœï¼‰
  - è£…å¤‡å±æ€§è®¡ç®—ï¼ˆæ ¹æ®å¼ºåŒ–ç­‰çº§ã€ç²¾ç‚¼ç­‰çº§ã€å“è´¨ã€æ˜Ÿçº§ã€é˜¶çº§ï¼Œä½¿ç”¨ä¸‡åˆ†æ¯”ï¼‰
  - æ•°æ®å­˜å‚¨åœ¨`PlayerRoleBinaryData.equip_data`ä¸­
- **ç³»ç»Ÿ**: `EquipSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/equip_sys.go`
- **æ•°æ®å­˜å‚¨**: `PlayerRoleBinaryData.equip_data`ï¼ˆ`SiEquipData`ï¼‰
- **é…ç½®**: `equip_upgrade_config.json`ã€`equip_refine_config.json`ã€`equip_enchant_config.json`ã€`equip_set_config.json`
- **äº‹ä»¶**: `OnEquipChange`, `OnEquipUpgrade`

##### 2.1.3 è´§å¸ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - æ”¯æŒå¤šç§è´§å¸ï¼ˆé‡‘å¸ã€é’»çŸ³ç­‰ï¼‰
  - ç»éªŒå€¼ä½œä¸ºè´§å¸ç±»å‹ä¹‹ä¸€ï¼Œç»Ÿä¸€ç”±è´§å¸ç³»ç»Ÿç®¡ç†
  - è´§å¸å¢å‡æ“ä½œï¼ˆé€šç”¨è´§å¸ç”±`MoneySys`ç›´æ¥å¤„ç†ï¼Œç‰¹æ®Šè´§å¸å¦‚ç»éªŒè·¯ç”±åˆ°å¯¹åº”ç³»ç»Ÿï¼‰
  - æ•°æ®å­˜å‚¨åœ¨`PlayerRoleBinaryData.money_data`ä¸­
  - äº‹åŠ¡æ”¯æŒï¼ˆæ¶ˆè€—/å¥–åŠ±ï¼‰
- **ç³»ç»Ÿ**: `MoneySys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/money_sys.go`
- **æ•°æ®å­˜å‚¨**: `PlayerRoleBinaryData.money_data`ï¼ˆ`SiMoneyData`ï¼‰

##### 2.1.4 ç­‰çº§ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - ç»éªŒå€¼æ·»åŠ ï¼ˆ`AddExp()`æ–¹æ³•ï¼‰
  - è‡ªåŠ¨å‡çº§æ£€æŸ¥ï¼ˆ`CheckLevelUp()`æ–¹æ³•ï¼Œæ”¯æŒè¿ç»­å‡çº§ï¼‰
  - å‡çº§å¥–åŠ±å‘æ”¾ï¼ˆä½¿ç”¨`GrantRewards`æ¥å£ï¼‰
  - å‡çº§äº‹ä»¶å‘å¸ƒï¼ˆ`OnPlayerLevelUp`å’Œ`OnPlayerExpChange`ï¼‰
  - å±æ€§è®¡ç®—ï¼ˆ`CalculateAttrs()`æ–¹æ³•ï¼Œä»ç­‰çº§é…ç½®è¡¨è·å–å±æ€§ï¼‰
  - æ•°æ®å­˜å‚¨åœ¨`PlayerRoleBinaryData.level_data`ä¸­
- **ç³»ç»Ÿ**: `LevelSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/level_sys.go`
- **æ•°æ®å­˜å‚¨**: `PlayerRoleBinaryData.level_data`ï¼ˆ`SiLevelData`ï¼‰

##### 2.1.5 å•†åŸç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - ä¸ªäººå•†åŸè´­ä¹°
  - æ”¯æŒé…ç½®åŒ–çš„æ¶ˆè€—/å¥–åŠ±
  - è‡ªåŠ¨å¤„ç†è´§å¸å’Œç‰©å“
- **ç³»ç»Ÿ**: `ShopSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/shop_sys.go`
- **é…ç½®**: `shop_config.json`

##### 2.1.6 ä»»åŠ¡ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - ä»»åŠ¡æ¥å—ï¼ˆ`AcceptQuest`ï¼Œæ£€æŸ¥ç­‰çº§è¦æ±‚ã€å‰ç½®ä»»åŠ¡ï¼‰
  - ä»»åŠ¡è¿›åº¦è¿½è¸ªï¼ˆ`UpdateQuestProgress`æŒ‰ç›®æ ‡ç´¢å¼•æ›´æ–°ï¼Œ`UpdateQuestProgressByType`æŒ‰ç±»å‹è‡ªåŠ¨æ›´æ–°ï¼‰
  - ä»»åŠ¡æäº¤ï¼ˆ`SubmitQuest`ï¼Œæ£€æŸ¥å®Œæˆæ¡ä»¶å¹¶å‘æ”¾å¥–åŠ±ï¼‰
  - ä»»åŠ¡é“¾æ”¯æŒï¼ˆ`NextQuests`å­—æ®µï¼Œè‡ªåŠ¨æ¥å–åç»­ä»»åŠ¡ï¼‰
  - æ—¥å¸¸/å‘¨å¸¸ä»»åŠ¡ç±»å‹æ”¯æŒï¼ˆ`Type`å­—æ®µï¼š3=æ—¥å¸¸ï¼Œ4=å‘¨å¸¸ï¼‰
  - ä»»åŠ¡å¥–åŠ±å‘æ”¾ï¼ˆç»éªŒé€šè¿‡`LevelSys.AddExp()`ï¼Œç‰©å“é€šè¿‡`GrantRewards()`ï¼‰
  - æ•°æ®å­˜å‚¨åœ¨`PlayerRoleBinaryData.quest_data`ä¸­
- **ç³»ç»Ÿ**: `QuestSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/quest_sys.go`
- **é…ç½®**: `quest_config.json`
- **ä»»åŠ¡é…ç½®æ ¼å¼**: ä½¿ç”¨`targets`æ•°ç»„ï¼Œæ ¼å¼ä¸º`[type, ids, count]`

##### 2.1.7 æ¯æ—¥ä»»åŠ¡ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - æ¯æ—¥ä»»åŠ¡åˆ·æ–°æœºåˆ¶ï¼ˆè·¨å¤©è‡ªåŠ¨åˆ·æ–°ï¼‰
  - æ¯æ—¥ä»»åŠ¡å¥–åŠ±å‘æ”¾ï¼ˆç»éªŒã€ç‰©å“ï¼‰
  - ä»»åŠ¡è¿›åº¦è¿½è¸ªï¼ˆæ”¯æŒæŒ‰ç±»å‹è‡ªåŠ¨æ›´æ–°ï¼‰
  - æ¯æ—¥ä»»åŠ¡æäº¤ï¼ˆå¯é‡å¤å®Œæˆï¼‰
  - æ•°æ®å­˜å‚¨åœ¨`PlayerRoleBinaryData.daily_quest_data`ä¸­
- **ç³»ç»Ÿ**: `DailyQuestSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/daily_quest_sys.go`
- **é…ç½®**: `daily_quest_config.json`

##### 2.1.8 é‚®ä»¶ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - é‚®ä»¶å‘é€ï¼ˆ`SendMail`æ¨¡æ¿é‚®ä»¶ã€`SendCustomMail`è‡ªå®šä¹‰é‚®ä»¶ï¼‰
  - é‚®ä»¶è¯»å–ï¼ˆ`ReadMail`æ ‡è®°å·²è¯»ï¼‰
  - é‚®ä»¶é™„ä»¶é¢†å–ï¼ˆ`ClaimMailAttachment`è§£æé™„ä»¶å¹¶å‘æ”¾å¥–åŠ±ï¼‰
  - é‚®ä»¶åˆ é™¤ï¼ˆ`DeleteMail`ï¼‰
  - é‚®ä»¶æ‰¹é‡æ“ä½œï¼ˆ`DeleteMails`æ‰¹é‡åˆ é™¤ã€`ClaimMailAttachments`æ‰¹é‡é¢†å–ï¼‰
  - é‚®ä»¶åˆ†ç±»ï¼ˆ`GetMailsByCategory`ï¼Œæ”¯æŒç³»ç»Ÿé‚®ä»¶ã€ç©å®¶é‚®ä»¶åˆ†ç±»ï¼‰
  - é‚®ä»¶æœç´¢ï¼ˆ`SearchMails`ï¼Œæ”¯æŒæŒ‰æ ‡é¢˜å’Œå†…å®¹æœç´¢ï¼‰
  - è¿‡æœŸé‚®ä»¶è‡ªåŠ¨æ¸…ç†ï¼ˆ`cleanExpiredMails`ï¼‰
  - æ•°æ®å­˜å‚¨åœ¨`PlayerRoleBinaryData.mail_data`ä¸­
- **ç³»ç»Ÿ**: `MailSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/mail_sys.go`
- **é…ç½®**: `mailtemplateconfig.json`

##### 2.1.9 VIPç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - VIPç»éªŒè·å–ï¼ˆ`AddVipExp`ï¼Œæ·»åŠ VIPç»éªŒå¹¶è‡ªåŠ¨æ£€æŸ¥å‡çº§ï¼‰
  - VIPç­‰çº§æå‡ï¼ˆ`CheckVipLevelUp`ï¼Œæ”¯æŒè¿ç»­å‡çº§ï¼‰
  - VIPç‰¹æƒåŠŸèƒ½ï¼ˆ`GetPrivilegeValue`ã€`HasPrivilege`ï¼Œè·å–æŒ‡å®šç‰¹æƒçš„å€¼ï¼‰
  - æ•°æ®å­˜å‚¨åœ¨`PlayerRoleBinaryData.vip_data`ä¸­
- **ç³»ç»Ÿ**: `VipSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/vip_sys.go`
- **é…ç½®**: `vipconfig.json`

##### 2.1.10 æŠ€èƒ½ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - æŠ€èƒ½å­¦ä¹ ï¼ˆ`LearnSkill`ï¼Œæ£€æŸ¥ç­‰çº§è¦æ±‚ã€æ¶ˆè€—ï¼‰
  - æŠ€èƒ½å‡çº§ï¼ˆ`UpgradeSkill`ï¼Œæ£€æŸ¥ç­‰çº§ä¸Šé™ã€æ¶ˆè€—ï¼ŒåŒæ­¥åˆ°DungeonServerï¼‰
  - æŠ€èƒ½æ•°æ®ç®¡ç†ï¼ˆæŠ€èƒ½åˆ—è¡¨å­˜å‚¨åœ¨`PlayerRoleBinaryData.skill_data`ä¸­ï¼‰
  - æ ¹æ®èŒä¸šé…ç½®åˆå§‹åŒ–åˆå§‹æŠ€èƒ½
  - è¿›å…¥å‰¯æœ¬æ—¶åŒæ­¥æŠ€èƒ½åˆ—è¡¨åˆ°DungeonServer
- **ç³»ç»Ÿ**: `SkillSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/skill_sys.go`
- **é…ç½®**: `skillconfig.json`
- **åè®®**: `C2SLearnSkill`ã€`C2SUpgradeSkill`ã€`G2DUpdateSkill`ï¼ˆRPCï¼‰

##### 2.1.11 ç‰©å“ä½¿ç”¨ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - ç‰©å“ä½¿ç”¨åè®®å¤„ç†ï¼ˆ`C2SUseItem`ï¼‰
  - ç‰©å“ä½¿ç”¨æ•ˆæœå¤„ç†ï¼ˆæ¢å¤HP/MPã€å¢åŠ ç»éªŒç­‰ï¼Œæ”¯æŒå¤šä¸ªæ•ˆæœå€¼ï¼‰
  - å†·å´æ—¶é—´ç®¡ç†ï¼ˆé»˜è®¤5ç§’ï¼Œå¯é…ç½®ï¼ŒæŒä¹…åŒ–åˆ°`PlayerRoleBinaryData.item_use_data`ï¼‰
  - ä½¿ç”¨åç‰©å“æ•°é‡å‡å°‘
  - GameServeråˆ°DungeonServerçš„RPCæ›´æ–°è§’è‰²HP/MPï¼ˆ`G2DUpdateHpMp`ï¼‰
- **ç³»ç»Ÿ**: `ItemUseSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/item_use_sys.go`
- **é…ç½®**: `item_use_effect_config.json`

##### 2.1.12 ç‰©å“å›æ”¶ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - ç‰©å“å›æ”¶åè®®å¤„ç†ï¼ˆ`C2SRecycleItem`ï¼‰
  - å›æ”¶å¥–åŠ±å‘æ”¾ï¼ˆæ ¹æ®`ItemRecycleConfig`ï¼‰
  - æ‰¹é‡å›æ”¶åŠŸèƒ½ï¼ˆæ”¯æŒcountå‚æ•°ï¼‰
  - ç‰©å“å¯å›æ”¶æ€§æ£€æŸ¥ï¼ˆé€šè¿‡ItemFlagæ£€æŸ¥ï¼‰
  - å›æ”¶å¥–åŠ±æŒ‰æ•°é‡è®¡ç®—ï¼ˆé…ç½®æ•°é‡ * å›æ”¶æ•°é‡ï¼‰
- **ç³»ç»Ÿ**: `RecycleSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/recycle_sys.go`
- **é…ç½®**: `item_recycle_config.json`

##### 2.1.13 å‰¯æœ¬ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - å‰¯æœ¬éš¾åº¦åŒºåˆ†ï¼ˆæ™®é€šã€ç²¾è‹±ã€åœ°ç‹±ï¼‰
  - å‰¯æœ¬ç»“ç®—ç³»ç»Ÿï¼ˆå¥–åŠ±è®¡ç®—ã€ç»éªŒå‘æ”¾ï¼‰
  - å‰¯æœ¬CDé™åˆ¶ï¼ˆå†·å´æ—¶é—´ç®¡ç†ï¼‰
  - å‰¯æœ¬è®°å½•æŒä¹…åŒ–ï¼ˆè¿›å…¥æ¬¡æ•°ã€æœ€åè¿›å…¥æ—¶é—´ï¼‰
  - å‡»æ€ç»Ÿè®¡ã€ç”¨æ—¶ç»Ÿè®¡
  - é™æ—¶å‰¯æœ¬æ”¯æŒï¼ˆè¿›å…¥æ¶ˆè€—æ£€æŸ¥ã€æ—¶é—´é™åˆ¶ã€è¿‡æœŸæ£€æŸ¥ï¼‰
  - æ•°æ®å­˜å‚¨åœ¨`PlayerRoleBinaryData.dungeon_data`ä¸­
- **ç³»ç»Ÿ**: `FubenSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/fuben_sys.go`
- **é…ç½®**: `dungeon_config.json`
- **åè®®**: `C2SEnterDungeon`

##### 2.1.14 ç¦»çº¿æ”¶ç›Šç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - ç¦»çº¿æ—¶é—´è®¡ç®—ï¼ˆç™»å‡ºæ—¶è®°å½•ç™»å‡ºæ—¶é—´ï¼Œç™»å½•æ—¶è®¡ç®—ç¦»çº¿æ—¶é—´ï¼‰
  - ç¦»çº¿æ”¶ç›Šè®¡ç®—ï¼ˆç»éªŒã€é‡‘å¸ç­‰ï¼Œæ¯åˆ†é’ŸåŸºç¡€æ”¶ç›Šï¼‰
  - ç¦»çº¿æ”¶ç›Šä¸Šé™ï¼ˆé»˜è®¤24å°æ—¶ï¼Œé˜²æ­¢æ— é™æ”¶ç›Šï¼‰
  - ç¦»çº¿æ”¶ç›Šé¢†å–åè®®å¤„ç†ï¼ˆ`C2SClaimOfflineReward`ï¼‰
  - ç¦»çº¿æ”¶ç›Šå‘æ”¾ï¼ˆä½¿ç”¨`GrantRewards`æ¥å£ï¼‰
  - æ•°æ®å­˜å‚¨åœ¨`PlayerRoleBinaryData.offline_reward_data`ä¸­
- **ç³»ç»Ÿ**: `OfflineRewardSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/offline_reward_sys.go`

##### 2.1.15 æˆå°±ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - æˆå°±é…ç½®è¡¨åŠ è½½
  - æˆå°±è¿›åº¦è¿½è¸ªï¼ˆæ”¯æŒæŒ‰ç±»å‹è‡ªåŠ¨æ›´æ–°ï¼‰
  - æˆå°±å¥–åŠ±å‘æ”¾ï¼ˆç»éªŒã€ç‰©å“ï¼‰
  - æˆå°±å®Œæˆé€šçŸ¥ï¼ˆè‡ªåŠ¨å®Œæˆå¹¶å‘æ”¾å¥–åŠ±ï¼‰
  - æˆå°±æ•°æ®æŒä¹…åŒ–ï¼ˆå­˜å‚¨åœ¨`PlayerRoleBinaryData.achievement_data`ä¸­ï¼‰
- **ç³»ç»Ÿ**: `AchievementSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/achievement_sys.go`
- **é…ç½®**: `achievement_config.json`

##### 2.1.16 æ–°æ‰‹ä¿æŠ¤ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - æ–°æ‰‹ä¿æŠ¤æ ‡è®°ï¼ˆç­‰çº§ã€æ—¶é—´é™åˆ¶ï¼Œé»˜è®¤7å¤©ä¿æŠ¤æœŸï¼‰
  - æ–°æ‰‹ä¿æŠ¤çŠ¶æ€æ£€æŸ¥ï¼ˆè‡ªåŠ¨æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼‰
  - æ–°æ‰‹å¼•å¯¼è¿›åº¦ä¿å­˜ï¼ˆæ”¯æŒå¤šä¸ªå¼•å¯¼æ­¥éª¤ï¼‰
  - æ–°æ‰‹ä¿æŠ¤çŠ¶æ€æ ¡éªŒï¼ˆ`IsNewbie()`ã€`IsNewbieByLevel()`æ–¹æ³•ï¼‰
  - æ•°æ®å­˜å‚¨åœ¨`PlayerRoleBinaryData.newbie_data`ä¸­
- **ç³»ç»Ÿ**: `NewbieSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/newbie_sys.go`

##### 2.1.17 é˜²ä½œå¼Šç³»ç»Ÿï¼ˆåŸºç¡€æ¡†æ¶ï¼‰âœ…
- **åŠŸèƒ½**:
  - æ“ä½œé¢‘ç‡é™åˆ¶ï¼ˆæ¯10ç§’æœ€å¤š100æ¬¡æ“ä½œï¼‰
  - å¼‚å¸¸è¡Œä¸ºæ£€æµ‹ï¼ˆå¯ç–‘è¡Œä¸ºè®¡æ•°ï¼‰
  - å°ç¦æœºåˆ¶ï¼ˆä¸´æ—¶å°ç¦å’Œæ°¸ä¹…å°ç¦ï¼‰
  - æ¯æ—¥é‡ç½®æœºåˆ¶ï¼ˆå‡Œæ™¨0ç‚¹é‡ç½®è®¡æ•°ï¼‰
  - å°ç¦çŠ¶æ€æ£€æŸ¥ï¼ˆè‡ªåŠ¨è§£é™¤è¿‡æœŸå°ç¦ï¼‰
  - æ•°æ®å­˜å‚¨åœ¨`PlayerRoleBinaryData.anti_cheat_data`ä¸­
- **ç³»ç»Ÿ**: `AntiCheatSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/anti_cheat_sys.go`
- **å¾…å®Œå–„**: åœ¨åè®®å¤„ç†ä¸­é›†æˆæ“ä½œé¢‘ç‡æ£€æµ‹ã€åŠ å¼ºç§»åŠ¨é€Ÿåº¦æ ¡éªŒã€å®ç°ä¼¤å®³æ•°å€¼æ ¡éªŒã€åŠ å¼ºæŠ€èƒ½CDæ ¡éªŒã€å®ç°æ•°æ®ä¸€è‡´æ€§æ ¡éªŒ

##### 2.1.18 GMç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - ç³»ç»Ÿé€šçŸ¥å‘é€ï¼ˆ`SendSystemNotification`ç»™æŒ‡å®šç©å®¶ã€`SendSystemNotificationToAll`ç»™æ‰€æœ‰åœ¨çº¿ç©å®¶ï¼‰
  - ç³»ç»Ÿé‚®ä»¶å‘é€ï¼ˆ`SendSystemMail`ç»™æŒ‡å®šç©å®¶ã€`SendSystemMailToAll`ç»™æ‰€æœ‰åœ¨çº¿ç©å®¶ã€`SendSystemMailByTemplate`ä½¿ç”¨æ¨¡æ¿ï¼‰
  - å¥–åŠ±è¡¥å‘ï¼ˆ`GrantRewardsByMail`é€šè¿‡é‚®ä»¶å‘æ”¾å¥–åŠ±ï¼‰
  - èƒŒåŒ…æ»¡æ—¶è‡ªåŠ¨é€šè¿‡é‚®ä»¶å‘æ”¾å¥–åŠ±ï¼ˆ`GrantRewards`æ–¹æ³•å·²æ”¯æŒï¼‰
- **ç³»ç»Ÿ**: `GMSys`ï¼ˆå•ä¾‹ï¼‰
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/gm_sys.go`

##### 2.1.19 GMå‘½ä»¤ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - GMå‘½ä»¤ç®¡ç†å™¨ï¼ˆ`GMManager`ï¼‰ï¼Œæ”¯æŒæ³¨å†Œå’Œæ‰§è¡ŒGMå‘½ä»¤
  - GMç­‰çº§æ ¡éªŒï¼ˆæ ¹æ®ç©å®¶GMç­‰çº§åˆ¤æ–­æ˜¯å¦å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼‰
  - é»˜è®¤GMå‘½ä»¤é›†ï¼š
    - `addexp <ç»éªŒå€¼>` - æ·»åŠ ç»éªŒï¼ˆGMç­‰çº§1ï¼‰
    - `addmoney <è´§å¸ID> <æ•°é‡>` - æ·»åŠ é‡‘å¸ï¼ˆGMç­‰çº§1ï¼‰
    - `additem <ç‰©å“ID> <æ•°é‡> [ç»‘å®š]` - æ·»åŠ ç‰©å“ï¼ˆGMç­‰çº§1ï¼‰
    - `setlevel <ç­‰çº§>` - è®¾ç½®ç­‰çº§ï¼ˆGMç­‰çº§2ï¼‰
    - `sendmail <æ ‡é¢˜> <å†…å®¹> [ç‰©å“åˆ—è¡¨]` - å‘é€ç³»ç»Ÿé‚®ä»¶ï¼ˆGMç­‰çº§2ï¼‰
    - `sendnotice <æ ‡é¢˜> <å†…å®¹> [ç±»å‹] [ä¼˜å…ˆçº§]` - å‘é€ç³»ç»Ÿé€šçŸ¥ï¼ˆGMç­‰çº§2ï¼‰
    - `sendnoticeall <æ ‡é¢˜> <å†…å®¹> [ç±»å‹] [ä¼˜å…ˆçº§]` - å…¨æœå‘é€ç³»ç»Ÿé€šçŸ¥ï¼ˆGMç­‰çº§3ï¼‰
    - `sendmailall <æ ‡é¢˜> <å†…å®¹> [ç‰©å“åˆ—è¡¨]` - å…¨æœå‘é€ç³»ç»Ÿé‚®ä»¶ï¼ˆGMç­‰çº§3ï¼‰
- **ç³»ç»Ÿ**: `GMManager`ï¼ˆå•ä¾‹ï¼‰
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/gm_manager.go`
- **åè®®**: `C2SGMCommand` / `S2CGMCommandResult`

##### 2.1.20 å±æ€§ç³»ç»Ÿæ±‡æ€»æ¶æ„ âœ…
- **åŠŸèƒ½**:
  - å±æ€§ç³»ç»Ÿæ³¨å†Œæœºåˆ¶ï¼ˆ`RegisterAttrCalculator`ï¼‰
  - å±æ€§æ±‡æ€»ï¼ˆ`CalculateAllAttrs()`æ–¹æ³•ï¼Œé¦–æ¬¡ç™»å½•æ—¶æ±‡æ€»æ‰€æœ‰å±æ€§ï¼‰
  - å±æ€§å¢é‡æ›´æ–°ï¼ˆ`MarkDirty()`æ ‡è®°éœ€è¦é‡ç®—çš„ç³»ç»Ÿï¼Œ`RunOne()`è®¡ç®—å˜åŠ¨çš„ç³»ç»Ÿå±æ€§å¹¶åŒæ­¥åˆ°DungeonServerï¼‰
  - å„ç³»ç»Ÿå±æ€§è®¡ç®—ï¼ˆ`LevelSys.CalculateAttrs()`ã€`EquipSys.CalculateAttrs()`ï¼‰
  - è£…å¤‡å˜æ›´å’Œå‡çº§æ—¶è‡ªåŠ¨æ ‡è®°å±æ€§ç³»ç»Ÿéœ€è¦é‡ç®—
- **ç³»ç»Ÿ**: `AttrSys`
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entitysystem/attr_sys.go`
- **åè®®**: `G2DSyncAttrs`ï¼ˆRPCå±æ€§åŒæ­¥ï¼‰

##### 2.1.21 è§’è‰²è¿›å…¥æ¸¸æˆæµç¨‹å®Œå–„ âœ…
- **åŠŸèƒ½**:
  - åœ¨`enterGame`å‡½æ•°ä¸­ï¼Œå…ˆè°ƒç”¨`OnLogin`åˆå§‹åŒ–ç³»ç»Ÿ
  - è°ƒç”¨`attr_sys.CalculateAllAttrs()`æ±‡æ€»æ‰€æœ‰å±æ€§
  - æ‰©å±•`G2DEnterDungeonReq`åè®®ï¼Œæ·»åŠ `SyncAttrData`å’Œ`SkillMap`å­—æ®µ
  - åœ¨è¿›å…¥å‰¯æœ¬è¯·æ±‚ä¸­æºå¸¦å±æ€§æ•°æ®å’ŒæŠ€èƒ½åˆ—è¡¨
  - åœ¨`PlayerRole`ä¸­æ·»åŠ `RunOne()`æ–¹æ³•ï¼Œè°ƒç”¨`attr_sys.RunOne()`å¤„ç†å±æ€§å¢é‡æ›´æ–°
- **ä½ç½®**: `server/service/gameserver/internel/playeractor/entity/player_network.go`ã€`player_role.go`

#### 2.2 å‰¯æœ¬ç³»ç»Ÿï¼ˆDungeonServerï¼‰

##### 2.2.1 æˆ˜æ–—è®¡ç®—ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - å®Œæ•´ä¼¤å®³å…¬å¼ï¼ˆæ”»å‡»åŠ›ã€é˜²å¾¡å‡å…ã€æŠ€èƒ½å€ç‡ã€å±æ€§ç›¸å…‹ï¼Œä½¿ç”¨ä¸‡åˆ†æ¯”ï¼‰
  - æš´å‡»ç³»ç»Ÿï¼ˆæš´å‡»ç‡ã€æš´å‡»ä¼¤å®³åŠ æˆï¼Œä½¿ç”¨ä¸‡åˆ†æ¯”ï¼‰
  - é—ªé¿ç³»ç»Ÿï¼ˆé—ªé¿ç‡ã€å‘½ä¸­ç‡ã€é€Ÿåº¦å½±å“ï¼Œä½¿ç”¨ä¸‡åˆ†æ¯”ï¼‰
  - å±æ€§ç›¸å…‹ï¼ˆç«ã€å†°ã€é›·å±æ€§æŠ—æ€§ï¼‰
  - ä¼¤å®³åŠ æˆ/å‡å…è®¡ç®—ï¼ˆä½¿ç”¨ä¸‡åˆ†æ¯”ï¼‰
  - æ²»ç–—é‡è®¡ç®—
- **ä½ç½®**: `server/service/dungeonserver/internel/skill/skill_damage_calculator.go`
- **ä¼¤å®³å…¬å¼**: 
  - åŸºç¡€ä¼¤å®³ = æ”»å‡»åŠ› * æŠ€èƒ½å€ç‡
  - é˜²å¾¡å‡å… = é˜²å¾¡åŠ› / (é˜²å¾¡åŠ› + æ”»å‡»è€…ç­‰çº§ * 10)
  - æœ€ç»ˆä¼¤å®³ = åŸºç¡€ä¼¤å®³ * (1 - é˜²å¾¡å‡å…) * å±æ€§ç›¸å…‹ * ä¼¤å®³åŠ æˆ/å‡å… * æš´å‡»å€ç‡ * éšæœºæµ®åŠ¨
  - **æ³¨æ„**: æ‰€æœ‰ç™¾åˆ†æ¯”è®¡ç®—ä½¿ç”¨ä¸‡åˆ†æ¯”ï¼ˆé™¤ä»¥10000ï¼‰

##### 2.2.2 æˆ˜æ–—çŠ¶æ€æœº âœ…
- **åŠŸèƒ½**:
  - çŠ¶æ€ç±»å‹ï¼šå¾…å‘½ã€æ–½æ³•ã€ç¡¬ç›´ã€å€’åœ°ã€æ­»äº¡ã€æ— æ•Œ
  - çŠ¶æ€è‡ªåŠ¨è¿‡æœŸï¼ˆæ ¹æ®æŒç»­æ—¶é—´ï¼‰
  - çŠ¶æ€åˆ‡æ¢é™åˆ¶ï¼ˆç¡¬ç›´/å€’åœ°ä¸èƒ½ç«‹å³åˆ‡æ¢åˆ°å¾…å‘½ï¼‰
  - çŠ¶æ€å½±å“å®ä½“è¡Œä¸ºï¼ˆæ”»å‡»ã€ç§»åŠ¨é™åˆ¶ï¼‰
- **ä½ç½®**: `server/service/dungeonserver/internel/entitysystem/state_machine.go`
- **é›†æˆ**: å·²é›†æˆåˆ° `BaseEntity` ä¸­
- **è§¦å‘**: å—åˆ°æ”»å‡»æ—¶æ ¹æ®ä¼¤å®³è‡ªåŠ¨è¿›å…¥ç¡¬ç›´çŠ¶æ€

##### 2.2.3 ç§»åŠ¨åŒæ­¥ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - å¤„ç† `C2SStartMove`ã€`C2SUpdateMove`ã€`C2SEndMove` è¯·æ±‚
  - æœåŠ¡ç«¯å¼ºæ ¡éªŒï¼ˆé€Ÿåº¦ã€åæ ‡è¿è´¯æ€§ã€å¯è¡Œèµ°åŒºåŸŸï¼‰
  - ç»Ÿä¸€å¹¿æ’­ `S2CEntityMove` / `S2CEntityStopMove`ï¼Œå¹¶åœ¨å¼‚å¸¸æ—¶è‡ªåŠ¨å›æ»šåæ ‡
  - ç§»åŠ¨ç»“æŸæ—¶åŒæ­¥åæ ‡åˆ°GameServerï¼ˆ`D2GSyncPosition` RPCï¼‰
- **å…³é”®ä»£ç **:
  - åè®®å±‚ï¼š`server/service/dungeonserver/internel/clientprotocol/movement_handler.go`
  - æ ¡éªŒç»„ä»¶ï¼š`server/service/dungeonserver/internel/movement/manager.go`
  - ç§»åŠ¨ç³»ç»Ÿï¼š`server/service/dungeonserver/internel/entitysystem/move_sys.go`
  - åœºæ™¯å¹¿æ’­ï¼š`clientprotocol/helpers.go`ï¼ˆå°è£…åœºæ™¯æ£€ç´¢ä¸åŒæ­¥ï¼‰

##### 2.2.4 ä¸»åŠ¨æˆ˜æ–—ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - å®Œæ•´å¤„ç† `C2SUseSkill`ï¼Œæ™®é€šæ”»å‡»ä½œä¸ºæŠ€èƒ½ID 0 å¹¶æ˜ å°„åˆ°é»˜è®¤æŠ€èƒ½ï¼ˆ1001ï¼‰
  - åè®®å±‚åœ¨é‡Šæ”¾å‰æ‰§è¡Œ CD / MP æ ¡éªŒï¼Œå¤±è´¥æ—¶å³æ—¶åé¦ˆ
  - é‡Šæ”¾ç»“æœè½¬æ¢ä¸º `S2CSkillCastResult` å¹¶å¹¿æ’­ï¼ŒåŒ…å«æ¯ä¸ªç›®æ ‡çš„å‘½ä¸­/æš´å‡»/ä¼¤å®³
- **å…³é”®ä»£ç **:
  - åè®®å±‚ï¼š`server/service/dungeonserver/internel/clientprotocol/skill_handler.go`
  - æˆ˜æ–—ç³»ç»Ÿï¼š`server/service/dungeonserver/internel/entitysystem/fight_sys.go`
  - æŠ€èƒ½æ‰§è¡Œï¼š`server/service/dungeonserver/internel/skill/skill.go`

##### 2.2.5 å‰¯æœ¬æ€ªç‰©AIçŠ¶æ€æœº âœ…
- **åŠŸèƒ½**:
  - å®ç°å·¡é€»â†’ä¾¦æµ‹â†’è¿½å‡»â†’æ”»å‡»â†’è„±æˆ˜è¿”å›çš„å®Œæ•´AIæµç¨‹
  - åŸºäº `monster_config.json` çš„ `aiConfig` è‡ªå®šä¹‰å·¡é€»åŠå¾„ã€æ„ŸçŸ¥èŒƒå›´ã€æ€è€ƒé¢‘ç‡ä¸å›å®¶è·ç¦»
  - AIè‡ªåŠ¨ç§»åŠ¨ï¼ˆå«å¯è¡Œèµ°æ ¡éªŒï¼‰å¹¶è°ƒç”¨æŠ€èƒ½ç³»ç»Ÿè¾“å‡ºç»“æœï¼ŒåŒæ—¶å¹¿æ’­ `S2CSkillCastResult`
  - AIé€»è¾‘å®Œå…¨ç”± `entity.RunOne()` é©±åŠ¨ï¼Œä¸¥ç¦å†å•ç‹¬å¼€å¯åç¨‹
- **å…³é”®ä»£ç **:
  - `server/service/dungeonserver/internel/entitysystem/ai_state.go`
  - `server/service/dungeonserver/internel/entitysystem/ai_sys.go`
  - `server/service/dungeonserver/internel/entity/monster.go`
  - é…ç½®: `server/output/config/monsterconfig.json`

##### 2.2.6 Buffç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - Buffé…ç½®åŒ–ï¼ˆä»`buff_config.json`è¯»å–ï¼Œæ”¯æŒ`effectType/stateId/tickInterval`ç­‰é…ç½®ï¼‰
  - Debuffæ–½åŠ ï¼ˆä¸­æ¯’ã€æµè¡€ã€å‡é€Ÿã€å†°å†»ç­‰ï¼Œè‡ªåŠ¨å†™å…¥çŠ¶æ€æœºæ‰©å±•çŠ¶æ€ï¼‰
  - DOTæ‰£è¡€æœºåˆ¶ï¼ˆRunOneå†…ç½®ï¼‰
- **ä½ç½®**: `server/service/dungeonserver/internel/entitysystem/buff_sys.go`
- **é…ç½®**: `buffconfig.json`

##### 2.2.7 å‰¯æœ¬å®ä½“ä¸»å¾ªç¯è°ƒåº¦ âœ…
- **åŠŸèƒ½**:
  - `DungeonActor` çš„ `Loop()` ç»Ÿä¸€é€šè¿‡ `entitymgr.RunOne()` é¡ºåºé©±åŠ¨æ¯ä¸ª `entity.RunOne()`
  - `BaseEntity.RunOne()` è´Ÿè´£è§¦å‘ `BuffSys`ã€`StateMachine` ç­‰ç³»ç»Ÿ
  - `MonsterEntity.RunOne()` é¢å¤–è°ƒåº¦ `AISys.RunOne()`
  - æ‰€æœ‰AI/Buff/çŠ¶æ€æ¨è¿›å¿…é¡»æ”¾åœ¨ `entity.RunOne()` å†…æ‰§è¡Œï¼Œç¦æ­¢å†å¯é¢å¤–åç¨‹
- **å…³é”®ä»£ç **:
  - `server/service/dungeonserver/internel/dungeonactor/adapter.go`
  - `server/service/dungeonserver/internel/entitymgr/mgr.go`
  - `server/service/dungeonserver/internel/entity/entity.go`

##### 2.2.8 å®ä½“çŠ¶æ€ä½å›¾ âœ…
- **åŠŸèƒ½**:
  - `BaseEntity` æ”¹ç”¨ `uint64 stateFlags` è¡¨ç¤ºæ­»äº¡ã€æ— æ•Œã€ç¦æ”»ã€ç¦ç§»ç­‰çŠ¶æ€ä½
  - æ‰€æœ‰çŠ¶æ€æ“ä½œé€šè¿‡ä½è¿ç®—å®Œæˆï¼Œé”ç²’åº¦æ›´å°
  - å¯æ‰©å±•æ›´å¤šæ ‡è®°
- **å…³é”®ä»£ç **:
  - `proto/csproto/entity_def.proto`ï¼ˆ`EntityStateFlag` æšä¸¾ï¼‰
  - `server/service/dungeonserver/internel/entity/entity.go`

##### 2.2.9 å®ä½“ç§»åŠ¨ç³»ç»Ÿ & è§†é‡å¹¿æ’­ âœ…
- **åŠŸèƒ½**:
  - æ–°å¢ `MoveSys`ï¼Œç»Ÿä¸€æ‰˜ç®¡ç©å®¶ä¸AIçš„ç§»åŠ¨çŠ¶æ€ï¼Œæ‰€æœ‰ç§»åŠ¨éƒ½é€šè¿‡ `RunOne()` åœ¨ä¸»çº¿ç¨‹æ¨è¿›
  - `clientprotocol/movement_handler` æ”¹ä¸ºè°ƒç”¨ `move_sys`ï¼Œä¿ç•™åŸæœ‰é€Ÿåº¦æ ¡éªŒä¸”å½»åº•æ¶ˆé™¤æ•°æ®ç«äº‰
  - è‡ªåŠ¨å¤„ç† AOI è¿›å…¥/ç¦»å¼€ï¼ŒåŠæ—¶ä¸‹å‘ `S2CEntityAppear/S2CEntityDisappear`ï¼Œå®¢æˆ·ç«¯å¯ç«‹å³è·å¾— HP/MP ç­‰å±æ€§
- **å…³é”®ä»£ç **:
  - `server/service/dungeonserver/internel/entitysystem/move_sys.go`
  - `server/service/dungeonserver/internel/clientprotocol/movement_handler.go`
  - `server/service/dungeonserver/internel/entityhelper/entity_snapshot.go`
  - `server/service/dungeonserver/internel/scene/scenest.go`

##### 2.2.10 å‰¯æœ¬ç»“ç®—ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - å‰¯æœ¬å¥–åŠ±è®¡ç®—ï¼ˆ`CalculateRewards`ï¼‰
  - å¥–åŠ±é…ç½®è¯»å–
  - DungeonServeråˆ°GameServerçš„RPCåè®®ï¼ˆ`D2GSettleDungeon`ï¼‰
  - é€šè¿‡RPCè°ƒç”¨GameServeræ›´æ–°å‰¯æœ¬è®°å½•ï¼ˆ`FubenSys.EnterDungeon()`ï¼‰
  - é€šè¿‡RPCè°ƒç”¨GameServerå‘æ”¾å¥–åŠ±ï¼ˆä½¿ç”¨`IPlayerRole.GrantRewards()`ï¼‰
  - ç»éªŒå¥–åŠ±é€šè¿‡ç­‰çº§ç³»ç»Ÿå‘æ”¾ï¼ˆ`LevelSys.AddExp()`ï¼‰
- **ä½ç½®**: `server/service/dungeonserver/internel/fuben/settlement.go`

##### 2.2.11 å¸¸é©»å‰¯æœ¬å¾ªç¯ âœ…
- **åŠŸèƒ½**:
  - `FuBenMgr.RunOne()` åŠ `FuBenSt.RunOne()` é©±åŠ¨å¸¸é©»/é™æ—¶å‰¯æœ¬çš„ä¸–ç•ŒçŠ¶æ€ï¼ˆç¤ºä¾‹ï¼šæ—¥å¤œäº¤æ›¿ï¼‰
  - `DungeonActor` ä¸»å¾ªç¯è¿½åŠ è°ƒç”¨ `fbmgr.RunOne()`ï¼Œå³ä¾¿æ— äººåœ¨çº¿å‰¯æœ¬ä¸–ç•Œä¹Ÿä¼šæ¨è¿›
  - ç§»é™¤"é™æ—¶å•äºº/å¤šäºº"åŒºåˆ†ï¼Œä»…ä¿ç•™å¸¸é©»/é™æ—¶ä¸¤ç§ç±»å‹
- **å…³é”®ä»£ç **:
  - `server/service/dungeonserver/internel/fbmgr/mgr.go`
  - `server/service/dungeonserver/internel/fuben/fubenst.go`
  - `server/service/dungeonserver/internel/dungeonactor/adapter.go`

##### 2.2.12 åœºæ™¯åˆ‡æ¢ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - åœºæ™¯åˆ‡æ¢åè®®ï¼ˆ`C2SChangeScene`ã€`S2CChangeSceneResult`ï¼‰
  - åŒå‰¯æœ¬å†…åœºæ™¯åˆ‡æ¢æ ¡éªŒï¼ˆä¸åŒå‰¯æœ¬ä¸èƒ½è·¨å‰¯æœ¬åœºæ™¯åˆ‡æ¢ï¼‰
  - è§’è‰²ä»åœºæ™¯1åˆ‡æ¢åˆ°åœºæ™¯2
  - åœºæ™¯åˆ‡æ¢æ—¶ä»åœºæ™¯é…ç½®çš„å‡ºç”Ÿç‚¹èŒƒå›´éšæœºé€‰æ‹©ä½ç½®
- **ä½ç½®**: `server/service/dungeonserver/internel/clientprotocol/scene_handler.go`

##### 2.2.13 æ‰è½ç‰©ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - æ€ªç‰©æ­»äº¡æ‰è½å¥–åŠ±åˆ°åœºæ™¯ä¸­ï¼ˆ`MonsterEntity.generateDrops`ï¼‰
  - æ‰è½ç‰©å®ä½“ï¼ˆ`DropItemEntity`ï¼‰ï¼š
    - å­˜åœ¨æ—¶é—´ç®¡ç†ï¼ˆé»˜è®¤60ç§’ï¼Œå¯é€šè¿‡é…ç½®`MonsterDrop.LifetimeSeconds`è‡ªå®šä¹‰ï¼‰
    - ä¸å¯è¢«æ”»å‡»ï¼ˆ`SetInvincible(true)`ï¼‰
    - ä¸å¯ç§»åŠ¨ï¼ˆ`SetCannotMove(true)`ï¼‰
    - è¶…æ—¶è‡ªåŠ¨ç§»é™¤ï¼ˆä¸è°ƒç”¨`BaseEntity.RunOne`ï¼Œåªæ£€æŸ¥è¶…æ—¶ï¼‰
    - ç§»é™¤æ—¶æ­£ç¡®æ¸…ç†åœºæ™¯ç»‘å®šï¼ˆ`UnbindScene`ï¼‰
  - æ‹¾å–æ‰è½ç‰©åè®®ï¼ˆ`C2SPickupItem`ã€`S2CPickupItemResult`ï¼‰
  - æ‰è½ç‰©å½’å±è€…æ ¡éªŒï¼ˆå‡»æ€æ€ªç‰©çš„ç©å®¶æ‰èƒ½æ‹¾å–ï¼‰
  - å¼‚æ­¥RPCå®ç°ï¼ˆ`D2GAddItem`ï¼Œä¸é˜»å¡Actoræ¨¡å‹ï¼‰
  - æˆåŠŸæ‹¾å–åæ‰è½ç‰©ä»åœºæ™¯ä¸­ç§»é™¤
  - å‡»æ€æ€ªç‰©è§¦å‘ä»»åŠ¡äº‹ä»¶è®¡æ•°
- **å…³é”®ä»£ç **:
  - `server/service/dungeonserver/internel/entity/drop_item.go`
  - `server/service/dungeonserver/internel/entity/monster.go`
  - `server/service/dungeonserver/internel/clientprotocol/pickup_handler.go`
  - `server/service/gameserver/internel/dungeonserverlink/protocol_rpc.go`
  - `server/service/dungeonserver/internel/fuben/actor_msg.go`

##### 2.2.14 è§’è‰²æ­»äº¡å¤æ´»ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - è§’è‰²æ­»äº¡åè‡ªåŠ¨å¤æ´»åˆ°æ–°æ‰‹æ‘ï¼ˆå»¶è¿Ÿ3ç§’ï¼‰
  - å®¢æˆ·ç«¯ä¸»åŠ¨å¤æ´»åè®®ï¼ˆ`C2SRevive`ã€`S2CReviveResult`ï¼‰
  - å¤æ´»é€»è¾‘ï¼šæ»¡è¡€æ»¡è“ã€ä¼ é€åˆ°æ–°æ‰‹æ‘ã€æ¸…é™¤æ­»äº¡çŠ¶æ€
  - å¤æ´»ä½ç½®è®¾ç½®ï¼ˆä»åœºæ™¯é…ç½®çš„å‡ºç”Ÿç‚¹èŒƒå›´éšæœºé€‰æ‹©ï¼‰
- **ä½ç½®**: 
  - `server/service/dungeonserver/internel/entity/rolest.go`ï¼ˆ`OnDie`æ–¹æ³•ã€`Revive`æ–¹æ³•ï¼‰
  - `server/service/dungeonserver/internel/clientprotocol/revive_handler.go`

##### 2.2.15 è·å–æœ€è¿‘æ€ªç‰©ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - è·å–æœ€è¿‘æ€ªç‰©åè®®ï¼ˆ`C2SGetNearestMonster`ã€`S2CGetNearestMonsterResult`ï¼‰
  - è·ç¦»è®¡ç®—ï¼ˆä½¿ç”¨æ¬§å‡ é‡Œå¾—è·ç¦»å…¬å¼ï¼‰
  - æ€ªç‰©ç­›é€‰ï¼ˆåªè¿”å›æ´»ç€çš„æ€ªç‰©ï¼‰
  - è¿”å›æœ€è¿‘çš„æ€ªç‰©ä¿¡æ¯ï¼ˆå¥æŸ„ã€IDã€åç§°ã€ä½ç½®ã€è·ç¦»ï¼‰
- **ä½ç½®**: `server/service/dungeonserver/internel/clientprotocol/monster_handler.go`

##### 2.2.16 DungeonServerå±æ€§æ¥æ”¶å’Œåˆå§‹åŒ–é€»è¾‘ âœ…
- **åŠŸèƒ½**:
  - ä¿®æ”¹`NewRoleEntity`å‡½æ•°ï¼Œæ¥æ”¶`SyncAttrData`å’Œ`SkillMap`å‚æ•°
  - åœ¨`RoleEntity`ä¸­ä¿å­˜å±æ€§æ•°æ®ï¼ˆ`saAttrSysId â†’ attrData`ï¼‰ï¼Œç”¨äºåç»­å±æ€§æ›´æ–°
  - å®ç°å±æ€§åˆå§‹åŒ–é€»è¾‘ï¼ˆ`applyAllAttrs()`æ–¹æ³•ï¼‰ï¼Œåº”ç”¨æ‰€æœ‰ç³»ç»Ÿçš„å±æ€§
  - å®ç°å±æ€§æ›´æ–°é€»è¾‘ï¼ˆ`UpdateAttrs()`æ–¹æ³•ï¼‰ï¼Œå¯¹æ¯”å·®å¼‚ï¼Œå¢åŠ å’Œå‡å°‘å±æ€§
  - å®ç°æŠ€èƒ½åˆ—è¡¨åˆå§‹åŒ–ï¼Œä½¿ç”¨ä¼ å…¥çš„`SkillMap`åˆå§‹åŒ–æŠ€èƒ½
  - å®ç°`handleG2DSyncAttrs`å‡½æ•°ï¼Œå¤„ç†å±æ€§åŒæ­¥è¯·æ±‚
  - æ·»åŠ `D2GEnterDungeonSuccess` RPCåè®®ï¼Œåœ¨åˆå§‹åŒ–æˆåŠŸåå‘é€é€šçŸ¥
- **å…³é”®ä»£ç **:
  - `server/service/dungeonserver/internel/entity/rolest.go`
  - `server/service/dungeonserver/internel/fuben/actor_msg.go`
  - `server/service/gameserver/internel/dungeonserverlink/protocol_rpc.go`

#### 2.3 é…ç½®ç³»ç»Ÿæ‰©å±• âœ…

##### 2.3.1 èŒä¸šé…ç½® âœ…
- **é…ç½®**: `job_config.json`
- **å†…å®¹**: èŒä¸šIDã€åç§°ã€æè¿°ã€åŸºç¡€å±æ€§ã€åˆå§‹æŠ€èƒ½åˆ—è¡¨ã€æ­¦å™¨ç±»å‹
- **ä½ç½®**: `server/internal/jsonconf/job_config.go`

##### 2.3.2 åœºæ™¯é…ç½® âœ…
- **é…ç½®**: `scene_config.json`
- **å†…å®¹**: åœºæ™¯IDã€åç§°ã€å°ºå¯¸ã€å‡ºç”Ÿç‚¹èŒƒå›´ï¼ˆ`BornArea`ï¼‰
- **ä½ç½®**: `server/internal/jsonconf/scene_config.go`

##### 2.3.3 æ€ªç‰©åœºæ™¯é…ç½® âœ…
- **é…ç½®**: `monster_scene_config.json`
- **å†…å®¹**: æ€ªç‰©IDã€åœºæ™¯IDã€å‡ºç”Ÿç‚¹èŒƒå›´ã€ç”Ÿæˆæ•°é‡
- **ä½ç½®**: `server/internal/jsonconf/monster_scene_config.go`

##### 2.3.4 NPCåœºæ™¯é…ç½® âœ…
- **é…ç½®**: `npc_scene_config.json`
- **å†…å®¹**: NPC IDã€åœºæ™¯IDã€ä½ç½®ã€åŠŸèƒ½ç±»å‹ã€å¯¹è¯/å•†åº—/ä¼ é€ç‚¹ID
- **ä½ç½®**: `server/internal/jsonconf/npc_scene_config.go`

##### 2.3.5 ä¼ é€ç‚¹é…ç½® âœ…
- **é…ç½®**: `teleport_config.json`
- **å†…å®¹**: ä¼ é€ç‚¹IDã€æºåœºæ™¯/ä½ç½®ã€ç›®æ ‡åœºæ™¯/ä½ç½®ã€ç­‰çº§è¦æ±‚ã€æ¶ˆè€—é…ç½®
- **ä½ç½®**: `server/internal/jsonconf/teleport_config.go`

##### 2.3.6 ItemConfigé‡æ„ä¸é…ç½®åˆ†ç¦» âœ…
- **åŠŸèƒ½**:
  - ç§»é™¤äº†`ItemConfig`ä¸­çš„ä¸šåŠ¡ç›¸å…³å­—æ®µï¼ˆ`EquipSlot`ã€`UpgradeCost`ã€`SellPrice`ã€`ShopConsumeId`ã€`ShopRewardId`ï¼‰
  - è£…å¤‡æ§½ä½æ”¹ä¸ºä½¿ç”¨`SubType`å­—æ®µï¼Œæ ¹æ®`Type`ç¡®å®š`SubType`çš„å«ä¹‰
  - ItemConfigæ·»åŠ äº†æ™®é€šå±æ€§ï¼ˆNormalAttrsï¼‰ã€æå“å±æ€§ï¼ˆRareAttrsï¼‰ã€æ˜Ÿçº§å±æ€§ï¼ˆStarAttrsï¼‰ã€å“è´¨å±æ€§ï¼ˆQualityAttrsï¼‰ã€é˜¶çº§å±æ€§ï¼ˆTierAttrsï¼‰
  - ItemConfigæ·»åŠ äº†é˜¶çº§ï¼ˆTierï¼‰ã€å“è´¨ï¼ˆQualityï¼‰ã€æ˜Ÿçº§ï¼ˆStarï¼‰å­—æ®µ
  - ItemConfigæ·»åŠ äº†uint64çš„Flagå­—æ®µï¼Œç”¨äºäºŒè¿›åˆ¶ä½æ ‡è¯†å¯ä½¿ç”¨ã€å¯å‡ºå”®ç­‰
  - åˆ›å»ºäº†ç‹¬ç«‹çš„è£…å¤‡å¼ºåŒ–é…ç½®è¡¨ï¼ˆ`EquipUpgradeConfig`ï¼‰
  - ItemUseEffectç‹¬ç«‹ä¸ºé…ç½®è¡¨ï¼ˆ`ItemUseEffectConfig`ï¼‰
  - ç‰©å“å›æ”¶é…ç½®ç‹¬ç«‹ï¼ˆ`ItemRecycleConfig`ï¼‰
  - å•†åŸè´­ä¹°é…ç½®ç‹¬ç«‹ï¼ˆ`ShopConfig`ï¼‰
- **æ¶æ„è®¾è®¡**:
  - **ItemConfigèŒè´£å•ä¸€åŒ–**: åªåŒ…å«é“å…·çš„åŸºç¡€ä¿¡æ¯ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘ç›¸å…³å­—æ®µ
  - **SubTypeè¯­ä¹‰åŒ–**: æ ¹æ®`Type`ç¡®å®š`SubType`çš„å«ä¹‰
    - `ItemTypeMoney` â†’ `SubType`è¡¨ç¤º`MoneyType`
    - `ItemTypeEquipment` â†’ `SubType`è¡¨ç¤º`EquipSlot`
  - **é…ç½®åˆ†ç¦»**: ä¸šåŠ¡ç›¸å…³é…ç½®ç‹¬ç«‹ï¼Œä¾¿äºç®¡ç†å’Œæ‰©å±•

##### 2.3.7 å…¨å±€ç­‰çº§å±æ€§è¡¨ç³»ç»Ÿ âœ…
- **åŠŸèƒ½**:
  - å®šä¹‰äº†é€šç”¨çš„å±æ€§ç»“æ„`Attr`å’Œ`AttrVec`ï¼Œå±æ€§æŒ‰key-valueå½¢å¼å­˜å‚¨
  - å®ç°äº†å…¨å±€ç­‰çº§å±æ€§è¡¨ï¼Œæ¯çº§æä¾›å±æ€§ï¼Œé«˜ç­‰çº§è¦†ç›–ä½ç­‰çº§å±æ€§
  - æ€ªç‰©ã€ç©å®¶å…±ç”¨ä¸€ä»½ç­‰çº§å±æ€§è¡¨ï¼Œç»Ÿä¸€ä»é…ç½®è¡¨è·å–å±æ€§
  - ç§»é™¤äº†ç¡¬ç¼–ç çš„å±æ€§è®¡ç®—é€»è¾‘ï¼Œæ”¹ä¸ºä»é…ç½®è¡¨è¯»å–
  - ItemConfigçš„EquipAttrsä¹Ÿæ”¹ä¸ºä½¿ç”¨AttrVecç»“æ„ï¼Œç»Ÿä¸€å±æ€§å­˜å‚¨æ ¼å¼
- **æ¶æ„è®¾è®¡**:
  - **é€šç”¨å±æ€§ç»“æ„**: `Attr`åŒ…å«`Type`ï¼ˆå±æ€§æšä¸¾ï¼‰å’Œ`Value`ï¼ˆå±æ€§å€¼ï¼‰ï¼Œ`AttrVec`ä¸ºå±æ€§åˆ—è¡¨
  - **ç­‰çº§å±æ€§è¡¨**: `LevelConfig`ä½¿ç”¨`AttrVec`å­˜å‚¨æ¯çº§çš„å±æ€§ï¼Œé«˜ç­‰çº§å±æ€§ä¼šè¦†ç›–ä½ç­‰çº§åŒåå±æ€§
  - **è£…å¤‡å±æ€§**: `ItemConfig.EquipAttrs`ä½¿ç”¨`AttrVec`å­˜å‚¨è£…å¤‡çš„åŸºç¡€å±æ€§
  - **å±æ€§è·å–**: `ConfigManager.GetLevelAttrs()`æ–¹æ³•ä»1çº§åˆ°æŒ‡å®šç­‰çº§é€çº§åˆå¹¶å±æ€§
  - **å®ä½“åˆå§‹åŒ–**: `RoleEntity`å’Œ`MonsterEntity`éƒ½ä½¿ç”¨`GetLevelAttrs()`è·å–ç­‰çº§å±æ€§

#### 2.4 ç³»ç»Ÿæ¶æ„ä¼˜åŒ– âœ…

##### 2.4.1 ç³»ç»Ÿæ•°æ®ç»Ÿä¸€å­˜å‚¨æ¶æ„ âœ…
- **åŠŸèƒ½**:
  - å„ä¸ªç³»ç»Ÿçš„æ•°æ®ç»Ÿä¸€å­˜å‚¨åœ¨`PlayerRoleBinaryData`ä¸­ï¼Œè€Œä¸æ˜¯å„è‡ªç»´æŠ¤ç‹¬ç«‹çš„å†…å­˜ç»“æ„
  - ç³»ç»Ÿé€šè¿‡`GetBinaryData()`è·å–æ•°æ®ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆå§‹åŒ–
  - ä¸‹å‘ç»™å®¢æˆ·ç«¯ç›´æ¥ä½¿ç”¨`PlayerRoleBinaryData`ä¸­çš„æ•°æ®ç»“æ„
  - ç§»é™¤äº†æ‰€æœ‰ç³»ç»Ÿçš„é”ï¼ˆsync.RWMutexï¼‰ï¼Œéµå¾ªå•Actoræ¨¡å‹
  - ç§»é™¤äº†é¢å¤–çš„ç´¢å¼•ç»“æ„ï¼ˆå¦‚`equipsMap`ã€`itemsMap`ï¼‰ï¼Œç›´æ¥ä½¿ç”¨åŸå§‹æ•°æ®ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´
- **æ¶æ„å†³ç­–**:
  - æ‰€æœ‰GameServerç³»ç»Ÿéƒ½ä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºæ¯ä¸ªç³»ç»Ÿåªè¢«å½“å‰è§’è‰²çš„Actorä½¿ç”¨
  - ç³»ç»Ÿå¿…é¡»ç›´æ¥ä½¿ç”¨`PlayerRoleBinaryData`ä¸­çš„æ•°æ®ï¼Œä¸è¦ç»´æŠ¤é¢å¤–çš„ç´¢å¼•ç»“æ„
  - å¦‚éœ€å¿«é€ŸæŸ¥æ‰¾ï¼Œä½¿ç”¨è¾…åŠ©å‡½æ•°ä»åŸå§‹æ•°æ®ä¸­æŸ¥æ‰¾

##### 2.4.2 æ•°æ®åº“å­˜å‚¨æ¶æ„ä¼˜åŒ– âœ…
- **åŠŸèƒ½**:
  - æ•°æ®åº“å­˜å‚¨ç©å®¶ä¿¡æ¯æ—¶ï¼Œåªéœ€è¦å­˜å‚¨äºŒè¿›åˆ¶çš„`PlayerRoleBinaryData`å³å¯
  - è¡¨ç»“æ„ç®€åŒ–ä¸ºï¼š`role_id`ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰ã€`job`ã€`sex`ã€`role_name`ã€`PlayerRoleBinaryData`ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰
  - ç§»é™¤äº†`PlayerBag`ã€`PlayerEquip`ã€`PlayerMoney`ã€`PlayerDungeon`ç­‰å¤šä½™çš„è¡¨ç»“æ„
  - æ‰€æœ‰ç³»ç»Ÿæ•°æ®ç»Ÿä¸€å­˜å‚¨åœ¨`Player.BinaryData`å­—æ®µä¸­ï¼Œé€šè¿‡protobufåºåˆ—åŒ–/ååºåˆ—åŒ–
  - ç³»ç»Ÿåˆå§‹åŒ–æ—¶ä»`Player.BinaryData`åŠ è½½æ•°æ®ï¼Œç™»å‡ºæ—¶ç»Ÿä¸€ä¿å­˜
  - å¯é€šè¿‡`SaveToDB()`æ–¹æ³•ç«‹å³ä¿å­˜æ•°æ®

##### 2.4.3 æ¶ˆè€—å’Œå¥–åŠ±äº‹åŠ¡æ”¯æŒ âœ…
- **åŠŸèƒ½**:
  - `ApplyConsume` æ”¯æŒäº‹åŠ¡ï¼Œè¦ä¹ˆå…¨æ¶ˆè€—æˆåŠŸï¼Œè¦ä¹ˆå…¨æ¶ˆè€—å¤±è´¥
  - `GrantRewards` æ”¯æŒäº‹åŠ¡ï¼Œè¦ä¹ˆå…¨æ·»åŠ æˆåŠŸï¼Œè¦ä¹ˆå…¨æ·»åŠ å¤±è´¥
  - æ•°æ®æ“ä½œæ”¯æŒäº‹åŠ¡ï¼Œå¤±è´¥æ—¶è‡ªåŠ¨å›æ»šå†…å­˜çŠ¶æ€
  - æ‰€æœ‰æ•°æ®æ“ä½œéƒ½åœ¨å†…å­˜ä¸­çš„`PlayerRoleBinaryData`è¿›è¡Œï¼Œä¸å†éœ€è¦æ•°æ®åº“äº‹åŠ¡

##### 2.4.4 å‰¯æœ¬Actorå•åç¨‹å¾ªç¯ä¿éšœ âœ…
- **åŠŸèƒ½**:
  - `actor_context.loop()` åŒæ­¥æ‰§è¡Œ `handler.Loop()` ä¸ `HandleMessage()`ï¼Œå½»åº•æœç»é¢å¤–åç¨‹å¯¼è‡´çš„ç«äº‰
  - `DungeonActor` é€šè¿‡ `entitymgr.RunOne()` é¡ºåºé©±åŠ¨ `entity.RunOne()`ï¼ŒAI/Buff/çŠ¶æ€æœºå…¨éƒ¨åœ¨å•çº¿ç¨‹å†…æ¨è¿›
  - `BaseActorHandler` åŒæ­¥åˆ†å‘åè®®å¤„ç†å‡½æ•°ï¼Œä¿æŒå‰¯æœ¬ä¸šåŠ¡éµå¾ªå•Actoræ¨¡å‹
- **å…³é”®ä»£ç **:
  - `server/internal/actor/actor_context.go`
  - `server/internal/actor/actor_handler.go`
  - `server/service/dungeonserver/internel/dungeonactor/adapter.go`

##### 2.4.5 å¼‚æ­¥RPCæ¶æ„ âœ…
- **åŸåˆ™**: æ‰€æœ‰DungeonServer â†” GameServerä¹‹é—´çš„RPCè°ƒç”¨å¿…é¡»ä½¿ç”¨å¼‚æ­¥æ–¹å¼ï¼Œä¸¥ç¦ä½¿ç”¨åŒæ­¥RPCï¼ˆ`SyncCall`ï¼‰ï¼Œé¿å…é˜»å¡Actoræ¨¡å‹
- **DungeonServer â†’ GameServer**: 
  - ä½¿ç”¨`CallGameServer()`å¼‚æ­¥å‘é€RPCè¯·æ±‚ï¼Œä¸ç­‰å¾…å“åº”
  - åœ¨`MessageSender`ä¸­ç»´æŠ¤`asyncRpcSessions`æ˜ å°„ï¼ˆRequestId â†’ SessionIdï¼‰ï¼Œç”¨äºå“åº”æ—¶è·¯ç”±
- **GameServerå¤„ç†**:
  - RPCè¯·æ±‚åœ¨PlayerRoleçš„Actorä¸­å¼‚æ­¥å¤„ç†ï¼ˆé€šè¿‡`gshare.SendMessageAsync`å‘é€åˆ°Actorï¼‰
  - å¤„ç†å®Œæˆåé€šè¿‡RPCå“åº”æ¶ˆæ¯å¼‚æ­¥å‘é€ç»“æœ
- **DungeonServerå“åº”å¤„ç†**:
  - æ”¶åˆ°RPCå“åº”åï¼Œé€šè¿‡`asyncRpcSessions`è·å–SessionId
  - é€šè¿‡SessionIdè·¯ç”±åˆ°Actorç³»ç»Ÿï¼ˆ`dshare.SendMessageAsync`ï¼‰ï¼Œåœ¨Actorä¸­å¤„ç†å“åº”å¹¶é€šçŸ¥å®¢æˆ·ç«¯
- **å…³é”®ä»£ç ä½ç½®**:
  - `server/service/dungeonserver/internel/gameserverlink/sender.go` - å¼‚æ­¥RPCå‘é€å’ŒSessionIdæ˜ å°„
  - `server/service/dungeonserver/internel/gameserverlink/network.go` - RPCå“åº”è·¯ç”±åˆ°Actorç³»ç»Ÿ
  - `server/service/gameserver/internel/dungeonserverlink/dungeon_cli.go` - RPCè¯·æ±‚è·¯ç”±åˆ°Actorç³»ç»Ÿ
  - `server/service/gameserver/internel/dungeonserverlink/protocol_rpc.go` - RPCå¤„ç†ï¼ˆå¼‚æ­¥å‘é€å“åº”ï¼‰
  - `server/service/dungeonserver/internel/fuben/actor_msg.go` - RPCå“åº”å¤„ç†ï¼ˆåœ¨Actorä¸­ï¼‰

##### 2.4.6 æšä¸¾è¿ç§»åˆ°Protoåè®® âœ…
- **åŠŸèƒ½**:
  - å°†æˆ˜æ–—çŠ¶æ€ç±»å‹ï¼ˆBattleStateï¼‰ã€AIStateã€BuffEffectTypeç­‰å…¬å…±æšä¸¾è¿ç§»åˆ°protoåè®®ä¸­ç”Ÿæˆ
  - å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±äº«åŒä¸€ä»½æšä¸¾å®šä¹‰ï¼Œé€šè¿‡å·¥å…·ä¸€é”®ç”Ÿæˆ
  - ä¿®æ”¹ä»£ç ä½¿ç”¨protoç”Ÿæˆçš„æšä¸¾æ›¿æ¢åŸæœ‰çš„å¸¸é‡å®šä¹‰
- **å…³é”®ä»£ç **:
  - `proto/csproto/entity_def.proto`ï¼ˆBattleStateã€AIStateæšä¸¾ï¼‰
  - `proto/csproto/buff_def.proto`ï¼ˆBuffEffectTypeæšä¸¾ï¼‰

##### 2.4.7 Protoç”Ÿæˆè„šæœ¬ä¼˜åŒ– âœ…
- **åŠŸèƒ½**:
  - `proto/genproto.sh` æ”¹ä¸ºä½¿ç”¨ `--go_out=paths=source_relative:..` ä¸ `--go_opt=module=postapocgame/server`
  - ç”Ÿæˆæ–‡ä»¶ç›´æ¥è¦†ç›– `server/internal/protocol`ï¼Œä¸å†äº§ç”Ÿ `server/server/internal/protocol` ç›®å½•
  - ç”Ÿæˆç»“æŸåè‡ªåŠ¨ `gofmt` é¡¹ç›®ä¸­çš„ Go æºç 
- **ä½¿ç”¨**: `bash proto/genproto.sh`

#### 2.5 æµ‹è¯•ä¸å·¥å…· âœ…

##### 2.5.1 å¼±ç½‘æµ‹è¯•å®¢æˆ·ç«¯ âœ…
- **åŠŸèƒ½**:
  - `server/example/client.go` å¯åŠ¨åè‡ªåŠ¨æ¨¡æ‹Ÿç™»å½• â†’ æŸ¥è¯¢è§’è‰² â†’ è¿›å…¥åœºæ™¯
  - `GameClient` è‡ªåŠ¨å‘èµ·å¼±ç½‘ç»œç§»åŠ¨ï¼ˆéšæœºæŠ–åŠ¨/ä¹±åº/é‡å¤åŒ…ï¼‰ä¸è‡ªç„æŠ€èƒ½æµ‹è¯•
  - `ClientHandler` è®¢é˜… `S2CEntityMove/StopMove/S2CSkillCastResult`ï¼Œä¾¿äºè§‚å¯Ÿ AOI å¹¿æ’­ä¸åºåˆ—å®¹é”™
- **å…³é”®ä»£ç **:
  - `server/example/game_client.go`
  - `server/example/client_handler.go`

##### 2.5.2 Phase 2 é›†æˆæµ‹è¯•å®¢æˆ·ç«¯ âœ…
- **åŠŸèƒ½**:
  - åœ¨ `server/example` ä¸‹æ–°å¢ç«¯åˆ°ç«¯æµ‹è¯•ï¼šè‡ªåŠ¨æ³¨å†ŒUUIDè´¦å·ã€åˆ›å»ºè§’è‰²ã€è¿›å…¥é»˜è®¤å‰¯æœ¬
  - åŒæ—¶åˆ›å»ºç©å®¶A/Bï¼ŒéªŒè¯ AOI äº’ç›¸å¯è§å¹¶é€šè¿‡ `C2SUseSkill` è§¦å‘æ™®é€šæ”»å‡»
  - æ—¥å¿—ä¸­è¾“å‡ºåŒæ–¹ HP/MP ä¸çŠ¶æ€ä½ï¼Œè¦†ç›–ç™»å½•â†’AOIâ†’æˆ˜æ–—çš„å®Œæ•´é“¾è·¯
- **å…³é”®ä»£ç **:
  - `server/example/scenario.go`
  - `server/example/game_client.go`
  - `server/example/client_handler.go`

---

## ğŸš§ å¾…å®ç°åŠŸèƒ½

### Phase 2: æ ¸å¿ƒç©æ³•è¡¥å……

#### 2.6.1 åŠ¨ç”»åŒæ­¥åè®® âš ï¸
**å½“å‰çŠ¶æ€**: æœªå®ç°

**éœ€è¦å®ç°**:
- æŠ€èƒ½é‡Šæ”¾åŠ¨ç”»åŒæ­¥ï¼ˆ`S2CSkillCastAnimation`ï¼‰
- å—å‡»åŠ¨ç”»åŒæ­¥ï¼ˆ`S2CHitAnimation`ï¼‰
- ç§»åŠ¨åŠ¨ç”»åŒæ­¥ï¼ˆ`S2CMoveAnimation`ï¼‰
- çŠ¶æ€åˆ‡æ¢åŠ¨ç”»åŒæ­¥ï¼ˆ`S2CStateChangeAnimation`ï¼‰

**ç›¸å…³ä»£ç ä½ç½®**:
- æŠ€èƒ½ç³»ç»Ÿ: `server/service/dungeonserver/internel/skill/skill.go`
- å®ä½“ç³»ç»Ÿ: `server/service/dungeonserver/internel/entity/entity.go`

#### 2.6.2 æˆ˜æ–—å½•åƒåŠŸèƒ½ âš ï¸
**å½“å‰çŠ¶æ€**: æœªå®ç°

**éœ€è¦å®ç°**:
- æˆ˜æ–—è¿‡ç¨‹å½•åˆ¶ï¼ˆè®°å½•æ‰€æœ‰æˆ˜æ–—äº‹ä»¶ï¼‰
- å½•åƒå›æ”¾ï¼ˆæŒ‰æ—¶é—´é¡ºåºé‡æ”¾äº‹ä»¶ï¼‰
- å½•åƒå­˜å‚¨ï¼ˆåºåˆ—åŒ–åˆ°æ–‡ä»¶æˆ–æ•°æ®åº“ï¼‰

#### 2.6.3 å‰¯æœ¬åŒ¹é…/æ’é˜Ÿç³»ç»Ÿ âš ï¸
**å½“å‰çŠ¶æ€**: æœªå®ç°

**éœ€è¦å®ç°**:
- å¤šäººå‰¯æœ¬åŒ¹é…ï¼ˆæŒ‰ç­‰çº§ã€æˆ˜åŠ›åŒ¹é…ï¼‰
- æ’é˜Ÿç³»ç»Ÿï¼ˆç­‰å¾…åŒ¹é…ï¼‰
- åŒ¹é…ç®—æ³•ï¼ˆELOã€MMRç­‰ï¼‰

**ç›¸å…³ä»£ç ä½ç½®**:
- å‰¯æœ¬ç®¡ç†å™¨: `server/service/dungeonserver/internel/fbmgr/mgr.go`

#### 2.6.4 Bossæˆ˜ç‰¹æ®Šæœºåˆ¶ âš ï¸
**å½“å‰çŠ¶æ€**: æœªå®ç°

**éœ€è¦å®ç°**:
- Bossé˜¶æ®µåˆ‡æ¢ï¼ˆè¡€é‡é˜ˆå€¼è§¦å‘ï¼‰
- Bossç‰¹æ®ŠæŠ€èƒ½ï¼ˆé˜¶æ®µæŠ€èƒ½ï¼‰
- Bossæ‰è½æœºåˆ¶ï¼ˆç‰¹æ®Šæ‰è½è¡¨ï¼‰

#### 2.6.5 é˜²ä½œå¼Šæœºåˆ¶å®Œå–„ âš ï¸
**å½“å‰çŠ¶æ€**: åŸºç¡€æ¡†æ¶å·²å®Œæˆï¼Œéƒ¨åˆ†åŠŸèƒ½å¾…å®Œå–„

**å¾…å®Œå–„åŠŸèƒ½**:
1. âš ï¸ åœ¨åè®®å¤„ç†ä¸­é›†æˆæ“ä½œé¢‘ç‡æ£€æµ‹
2. âš ï¸ åŠ å¼ºç§»åŠ¨é€Ÿåº¦æ ¡éªŒï¼ˆDungeonServerå·²æœ‰ï¼Œéœ€è¦åŠ å¼ºï¼‰
3. âš ï¸ å®ç°ä¼¤å®³æ•°å€¼æ ¡éªŒï¼ˆDungeonServerï¼‰
4. âš ï¸ åŠ å¼ºæŠ€èƒ½CDæ ¡éªŒï¼ˆDungeonServerå·²æœ‰ï¼Œéœ€è¦åŠ å¼ºï¼‰
5. âš ï¸ å®ç°æ•°æ®ä¸€è‡´æ€§æ ¡éªŒ

**ç›¸å…³ä»£ç ä½ç½®**:
- `server/service/dungeonserver/internel/entitysystem/move_sys.go`ï¼ˆç§»åŠ¨é€Ÿåº¦æ ¡éªŒï¼‰
- `server/service/dungeonserver/internel/entitysystem/fight_sys.go`ï¼ˆæŠ€èƒ½CDæ ¡éªŒï¼‰
- `server/service/dungeonserver/internel/skill/skill_damage_calculator.go`ï¼ˆä¼¤å®³è®¡ç®—ï¼Œéœ€è¦æ·»åŠ æ ¡éªŒï¼‰

#### 2.6.6 æ•°æ®ç»Ÿè®¡ä¸åˆ†æ âš ï¸
**å½“å‰çŠ¶æ€**: æœªå®ç°

**éœ€è¦å®ç°**:
- å…³é”®äº‹ä»¶è®°å½•ï¼ˆç™»å½•ã€æˆ˜æ–—ã€ä»»åŠ¡å®Œæˆç­‰ï¼‰
- æ•°æ®ç»Ÿè®¡æ¥å£
- ç©å®¶è¡Œä¸ºåˆ†æ
- æ€§èƒ½ç›‘æ§
- æ•°æ®ä¸ŠæŠ¥

**ç›¸å…³ä»£ç ä½ç½®**:
- `server/service/gameserver/internel/playeractor/entitysystem/statistics_sys.go`ï¼ˆæ–°å»ºï¼‰

### Phase 3: ç¤¾äº¤ç»æµï¼ˆå¾…å®ç°ï¼‰

#### 3.1 èŠå¤©ç³»ç»Ÿ âš ï¸
**å½“å‰çŠ¶æ€**: æœªå®ç°

**éœ€è¦å®ç°**:
- å…¨æœ/ä¸–ç•Œ/ç§èŠé¢‘é“
- èŠå¤©æ¶ˆæ¯è¿‡æ»¤ï¼ˆæ•æ„Ÿè¯ã€é¢‘ç‡é™åˆ¶ï¼‰
- ä½ç½®: å»ºè®®åœ¨GameServerä¸­å®ç°ï¼ˆç©å®¶Actoræ¨¡å‹ï¼‰

#### 3.2 å¥½å‹/å…¬ä¼šæ¡†æ¶ âš ï¸
**å½“å‰çŠ¶æ€**: æœªå®ç°

**éœ€è¦å®ç°**:
- å¥½å‹ç³»ç»Ÿï¼ˆæ·»åŠ ã€åˆ é™¤ã€åˆ—è¡¨ã€åœ¨çº¿çŠ¶æ€ï¼‰
- å…¬ä¼šåŸºç¡€åŠŸèƒ½ï¼ˆåˆ›å»ºã€åŠ å…¥ã€é€€å‡ºã€æˆå‘˜ç®¡ç†ï¼‰
- ä½ç½®: å»ºè®®åœ¨GameServerä¸­å®ç°

#### 3.3 æ‹å–è¡Œ âš ï¸
**å½“å‰çŠ¶æ€**: ä¸ªäººå•†åŸå·²å®ç°ï¼Œä½†ç¼ºå°‘æ‹å–è¡Œ

**éœ€è¦å®ç°**:
- æ‹å–è¡Œï¼ˆä¸Šæ¶ã€è´­ä¹°ã€ä¸‹æ¶ã€ç«ä»·ï¼‰
- ä½ç½®: å»ºè®®åœ¨GameServerä¸­å®ç°

#### 3.4 æ’è¡Œæ¦œç³»ç»Ÿ âš ï¸
**å½“å‰çŠ¶æ€**: æœªå®ç°

**éœ€è¦å®ç°**:
- ç­‰çº§æ¦œã€æˆ˜åŠ›æ¦œã€å‰¯æœ¬é€šå…³æ¦œç­‰
- ä½ç½®: å»ºè®®åœ¨GameServerä¸­å®ç°

### Phase 4: PvPå†…å®¹ï¼ˆå¾…å®ç°ï¼‰

#### 4.1 ç«æŠ€åœºç³»ç»Ÿ âš ï¸
**å½“å‰çŠ¶æ€**: æœªå®ç°

**éœ€è¦å®ç°**:
- åŒ¹é…ã€æˆ˜æ–—ã€è¯„åˆ†
- ä½ç½®: å»ºè®®åœ¨DungeonServerä¸­å®ç°ï¼ˆæˆ˜æ–—é€»è¾‘ï¼‰

#### 4.2 å®æ—¶é…å¯¹ç³»ç»Ÿ âš ï¸
**å½“å‰çŠ¶æ€**: æœªå®ç°

**éœ€è¦å®ç°**:
- PvPåŒ¹é…ç®—æ³•ï¼ˆELOã€MMRç­‰ï¼‰
- ä½ç½®: å»ºè®®åœ¨GameServerä¸­å®ç°ï¼ˆåŒ¹é…é€»è¾‘ï¼‰

#### 4.3 è¯„åˆ†ç³»ç»Ÿ âš ï¸
**å½“å‰çŠ¶æ€**: æœªå®ç°

**éœ€è¦å®ç°**:
- ç§¯åˆ†è®¡ç®—ã€æ’åæ›´æ–°
- ä½ç½®: å»ºè®®åœ¨GameServerä¸­å®ç°

---

## ğŸ“ å…³é”®ä»£ç ä½ç½®

### æ•°æ®åº“å±‚
- `server/internal/database/` - æ‰€æœ‰æ•°æ®åº“æ“ä½œ
  - `database.go` - æ•°æ®åº“åˆå§‹åŒ–
  - `migrate.go` - è¡¨è¿ç§»
  - `account.go` - è´¦å·ç›¸å…³
  - `player.go` - è§’è‰²ç›¸å…³ï¼ˆåŒ…å«`BinaryData`å­—æ®µå­˜å‚¨`PlayerRoleBinaryData`ï¼‰
  - `token.go` - Tokenç”Ÿæˆ
  - **æ³¨æ„**: æ‰€æœ‰ç³»ç»Ÿæ•°æ®ç»Ÿä¸€å­˜å‚¨åœ¨`Player.BinaryData`å­—æ®µä¸­ï¼ˆprotobufåºåˆ—åŒ–çš„`PlayerRoleBinaryData`ï¼‰ï¼Œä¸å†ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“è¡¨

### æ¸¸æˆæœåŠ¡å™¨ç³»ç»Ÿ
- `server/service/gameserver/internel/playeractor/entitysystem/` - ç©å®¶ç³»ç»Ÿ
  - `bag_sys.go` - èƒŒåŒ…ç³»ç»Ÿ âœ…ï¼ˆä½¿ç”¨`PlayerRoleBinaryData.bag_data`ï¼Œæ— é”ï¼‰
  - `equip_sys.go` - è£…å¤‡ç³»ç»Ÿ âœ…ï¼ˆä½¿ç”¨`PlayerRoleBinaryData.equip_data`ï¼Œæ— é”ï¼Œå®ç°`CalculateAttrs()`æ–¹æ³•ï¼‰
  - `level_sys.go` - ç­‰çº§ç³»ç»Ÿ âœ…ï¼ˆåŠŸèƒ½å·²å®Œæ•´å®ç°ï¼Œå®ç°`CalculateAttrs()`æ–¹æ³•ï¼‰
  - `money_sys.go` - è´§å¸ç³»ç»Ÿ âœ…ï¼ˆä½¿ç”¨`PlayerRoleBinaryData.money_data`ï¼Œæ— é”ï¼‰
  - `fuben_sys.go` - å‰¯æœ¬ç³»ç»Ÿ âœ…ï¼ˆä½¿ç”¨`PlayerRoleBinaryData.dungeon_data`ï¼Œæ— é”ï¼‰
  - `shop_sys.go` - å•†åŸç³»ç»Ÿ âœ…ï¼ˆæ— é”ï¼‰
  - `sys_mgr.go` - ç³»ç»Ÿç®¡ç†å™¨
  - `quest_sys.go` - ä»»åŠ¡ç³»ç»Ÿ âœ…ï¼ˆåŠŸèƒ½å·²å®Œæ•´å®ç°ï¼Œæ”¯æŒä»»åŠ¡é“¾ã€æ—¥å¸¸/å‘¨å¸¸ä»»åŠ¡ï¼‰
  - `mail_sys.go` - é‚®ä»¶ç³»ç»Ÿ âœ…ï¼ˆåŠŸèƒ½å·²å®Œæ•´å®ç°ï¼Œæ”¯æŒæ‰¹é‡æ“ä½œã€åˆ†ç±»ã€æœç´¢ï¼‰
  - `vip_sys.go` - VIPç³»ç»Ÿ âœ…ï¼ˆåŠŸèƒ½å·²å®Œæ•´å®ç°ï¼‰
  - `gm_sys.go` - GMç³»ç»Ÿ âœ…ï¼ˆåŠŸèƒ½å·²å®Œæ•´å®ç°ï¼‰
  - `gm_manager.go` - GMå‘½ä»¤ç®¡ç†å™¨ âœ…
  - `attr_sys.go` - å±æ€§ç³»ç»Ÿæ±‡æ€» âœ…ï¼ˆå±æ€§ç³»ç»Ÿæ±‡æ€»æ¶æ„ï¼Œå®ç°å±æ€§åŠ¨æ€è®¡ç®—å’Œå¢é‡åŒæ­¥ï¼‰
  - `item_use_sys.go` - ç‰©å“ä½¿ç”¨ç³»ç»Ÿ âœ…ï¼ˆå·²é‡æ„ä¸ºæ³¨å†Œç³»ç»Ÿï¼Œå†·å´æ—¶é—´æŒä¹…åŒ–ï¼‰
  - `recycle_sys.go` - ç‰©å“å›æ”¶ç³»ç»Ÿ âœ…
  - `skill_sys.go` - æŠ€èƒ½ç³»ç»Ÿ âœ…ï¼ˆæŠ€èƒ½å­¦ä¹ ã€æŠ€èƒ½å‡çº§ã€æŠ€èƒ½æ•°æ®ç®¡ç†ï¼Œå·²å®Œå–„RPCåŒæ­¥ï¼‰
  - `offline_reward_sys.go` - ç¦»çº¿æ”¶ç›Šç³»ç»Ÿ âœ…
  - `anti_cheat_sys.go` - é˜²ä½œå¼Šç³»ç»Ÿ âœ…ï¼ˆåŸºç¡€æ¡†æ¶å·²å®Œæˆï¼‰
  - `daily_quest_sys.go` - æ¯æ—¥ä»»åŠ¡ç³»ç»Ÿ âœ…
  - `achievement_sys.go` - æˆå°±ç³»ç»Ÿ âœ…
  - `newbie_sys.go` - æ–°æ‰‹ä¿æŠ¤ç³»ç»Ÿ âœ…

### åè®®å®šä¹‰
- `proto/csproto/` - Protocol Bufferå®šä¹‰
  - `cs.proto` - å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨åè®®
  - `sc.proto` - æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯åè®®
  - `system.proto` - ç³»ç»Ÿæ•°æ®å®šä¹‰ï¼ˆåŒ…å«æ‰€æœ‰ç³»ç»ŸIDå’Œæ•°æ®ç»“æ„ï¼‰
  - `base.proto` - åŸºç¡€æ•°æ®ç»“æ„ï¼ˆ`AttrSt`ã€`ItemAmount`ç­‰ï¼‰
  - `entity_def.proto` - å®ä½“æšä¸¾ & çŠ¶æ€ä½å®šä¹‰ï¼ˆBattleStateã€AIStateã€EntityStateFlagï¼‰
  - `item_def.proto` - ç‰©å“ç›¸å…³æšä¸¾ï¼ˆ`ItemType`ã€`MoneyType`ã€`EquipSlot`ã€`ItemFlag`ï¼‰
  - `attr_def.proto` - å±æ€§ç³»ç»Ÿå®šä¹‰ï¼ˆ`SaAttrSys`æšä¸¾ã€`SyncAttrData`ã€`AttrVec`ï¼‰
  - `quest_def.proto` - ä»»åŠ¡ç±»å‹æšä¸¾å®šä¹‰ï¼ˆ`QuestType`æšä¸¾ï¼‰
  - `buff_def.proto` - Buffç›¸å…³æšä¸¾ï¼ˆ`BuffEffectType`ï¼‰
  - `rpc.proto` - RPCåè®®å®šä¹‰ï¼ˆåŒ…å«æ‰€æœ‰GameServerå’ŒDungeonServerä¹‹é—´çš„RPCåè®®ï¼‰
  - `player.proto` - ç©å®¶æ•°æ®å®šä¹‰ï¼ˆåŒ…å«`PlayerRoleBinaryData`ï¼Œæ‰€æœ‰ç³»ç»Ÿæ•°æ®å­—æ®µï¼‰
- ç”Ÿæˆä»£ç ä½ç½®: `server/internal/protocol/`
- ç”Ÿæˆè„šæœ¬: `proto/genproto.sh`ï¼ˆå·²ä¿®æ­£è¾“å‡ºè·¯å¾„å¹¶è‡ªåŠ¨ gofmtï¼‰ âœ…

### é…ç½®ç³»ç»Ÿ
- `server/internal/jsonconf/` - é…ç½®ç®¡ç†
  - `config_manager.go` - é…ç½®ç®¡ç†å™¨ï¼ˆæ”¯æŒæ‰€æœ‰é…ç½®çš„åŠ è½½å’Œè·å–ï¼‰
  - `attr.go` - é€šç”¨å±æ€§ç»“æ„å®šä¹‰ï¼ˆ`Attr`ã€`AttrVec`ï¼‰
  - `level_config.go` - ç­‰çº§é…ç½®ï¼ˆä½¿ç”¨`AttrVec`å­˜å‚¨ç­‰çº§å±æ€§ï¼‰
  - `item_config.go` - ç‰©å“é…ç½®ï¼ˆå·²é‡æ„ï¼Œç§»é™¤ä¸šåŠ¡ç›¸å…³å­—æ®µï¼Œä½¿ç”¨SubTypeè¡¨ç¤ºæ§½ä½ï¼‰
  - `equip_upgrade_config.go` - è£…å¤‡å¼ºåŒ–é…ç½®è¡¨
  - `equip_refine_config.go` - è£…å¤‡ç²¾ç‚¼é…ç½®è¡¨
  - `equip_enchant_config.go` - è£…å¤‡é™„é­”é…ç½®è¡¨
  - `equip_set_config.go` - è£…å¤‡å¥—è£…é…ç½®è¡¨
  - `equip_const.go` - è£…å¤‡å¸¸é‡å®šä¹‰
  - `job_config.go` - èŒä¸šé…ç½® âœ…
  - `scene_config.go` - åœºæ™¯é…ç½® âœ…
  - `monster_scene_config.go` - æ€ªç‰©åœºæ™¯é…ç½® âœ…
  - `monster_config.go` - æ€ªç‰©é…ç½® âœ…
  - `npc_scene_config.go` - NPCåœºæ™¯é…ç½® âœ…
  - `teleport_config.go` - ä¼ é€ç‚¹é…ç½® âœ…
  - `daily_quest_config.go` - æ¯æ—¥ä»»åŠ¡é…ç½® âœ…
  - `achievement_config.go` - æˆå°±é…ç½® âœ…
  - `item_use_effect_config.go` - ç‰©å“ä½¿ç”¨æ•ˆæœé…ç½®
  - `item_recycle_config.go` - ç‰©å“å›æ”¶é…ç½®
  - `shop_config.go` - å•†åŸé…ç½®
  - `consume_config.go` - é€šç”¨æ¶ˆè€—é…ç½®
  - `reward_config.go` - é€šç”¨å¥–åŠ±é…ç½®
  - `quest_config.go` - ä»»åŠ¡é…ç½®
  - `mail_config.go` - é‚®ä»¶é…ç½®
  - `vip_config.go` - VIPé…ç½®
  - `money_config.go` - è´§å¸é…ç½®
  - `skill_config.go` - æŠ€èƒ½é…ç½®
  - `buff_config.go` - Buffé…ç½®
  - `dungeon_config.go` - å‰¯æœ¬é…ç½®
- é…ç½®æ–‡ä»¶ä½ç½®: `server/output/config/`ï¼ˆå…±26ä¸ªé…ç½®æ–‡ä»¶ï¼‰
- **æ³¨æ„**: é…ç½®æ–‡ä»¶åç§°å·²ä¿®å¤ï¼Œç¡®ä¿ä»£ç ä¸­çš„æ–‡ä»¶åä¸å®é™…æ–‡ä»¶ååŒ¹é…ï¼ˆå¦‚ itemconfig.jsonã€levelconfig.json ç­‰ï¼‰

### äº‹ä»¶ç³»ç»Ÿ
- `server/service/gameserver/internel/gevent/` - äº‹ä»¶å®šä¹‰
  - `enum.go` - äº‹ä»¶ç±»å‹æšä¸¾
  - `event.go` - äº‹ä»¶æ€»çº¿

### å‰¯æœ¬æœåŠ¡å™¨
- `server/service/dungeonserver/` - å‰¯æœ¬æœåŠ¡å™¨
  - `internel/entitysystem/` - å®ä½“ç³»ç»Ÿï¼ˆæˆ˜æ–—ã€å±æ€§ã€Buffã€çŠ¶æ€æœºç­‰ï¼‰
    - `state_machine.go` - æˆ˜æ–—çŠ¶æ€æœº âœ…
    - `fight_sys.go` - æˆ˜æ–—ç³»ç»Ÿï¼ˆUseSkillæ–¹æ³•ï¼‰âœ…
    - `attr_sys.go` - å±æ€§ç³»ç»Ÿ âœ…
    - `buff_sys.go` - Buffç³»ç»Ÿ âœ…
    - `aoi_sys.go` - AOIç³»ç»Ÿ âœ…
    - `ai_state.go` / `ai_sys.go` - å‰¯æœ¬æ€ªç‰©AIç³»ç»Ÿ âœ…
    - `move_sys.go` - ç§»åŠ¨ç³»ç»Ÿ âœ…
  - `internel/entity/` - å®ä½“å®šä¹‰
    - `entity.go` - åŸºç¡€å®ä½“ï¼ˆä½å›¾çŠ¶æ€/é€šç”¨å±æ€§/ç§»åŠ¨å…¥å£ï¼‰âœ…
    - `monster.go` - æ€ªç‰©å®ä½“ï¼ˆå«AIé›†æˆï¼Œä½¿ç”¨ç­‰çº§å±æ€§è¡¨ï¼‰âœ…
    - `rolest.go` - ç©å®¶å®ä½“ï¼ˆæ¥æ”¶GameServerå±æ€§æ•°æ®ï¼Œå®ç°å±æ€§åˆå§‹åŒ–å’Œæ›´æ–°ï¼Œå®ç°æ­»äº¡å¤æ´»ï¼‰âœ…
    - `drop_item.go` - æ‰è½ç‰©å®ä½“ âœ…
  - `internel/fuben/` - å‰¯æœ¬å®ç°
    - `fubenst.go` - å‰¯æœ¬ç»“æ„ï¼ˆå·²æ‰©å±•éš¾åº¦ã€ç»“ç®—ï¼‰ âœ…
    - `settlement.go` - å‰¯æœ¬ç»“ç®—ç³»ç»Ÿ âœ…
    - `default.go` - é»˜è®¤å‰¯æœ¬æ³¨å†Œä¸ç¼“å­˜ âœ…
    - `actor_msg.go` - å‰¯æœ¬Actoræ¶ˆæ¯å¤„ç† âœ…
  - `internel/fbmgr/` - å‰¯æœ¬ç®¡ç†å™¨
    - `mgr.go` - å‰¯æœ¬ç®¡ç†å™¨ï¼ˆå¸¸é©»å‰¯æœ¬å¾ªç¯ã€é™æ—¶å‰¯æœ¬ç®¡ç†ï¼‰âœ…
  - `internel/skill/` - æŠ€èƒ½ç³»ç»Ÿ
    - `skill.go` - æŠ€èƒ½é‡Šæ”¾é€»è¾‘ âœ…
    - `skill_damage_calculator.go` - ä¼¤å®³è®¡ç®—å™¨ï¼ˆå®Œæ•´å…¬å¼ï¼Œä½¿ç”¨ä¸‡åˆ†æ¯”ï¼‰ âœ…
  - `internel/clientprotocol/`
    - `movement_handler.go` - ç§»åŠ¨è¯·æ±‚æ ¡éªŒåŠå¹¿æ’­ âœ…
    - `skill_handler.go` - æŠ€èƒ½åè®®å¤„ç†ä¸ç»“æœå¹¿æ’­ âœ…
    - `scene_handler.go` - åœºæ™¯åˆ‡æ¢å¤„ç† âœ…
    - `revive_handler.go` - è§’è‰²å¤æ´»å¤„ç† âœ…
    - `monster_handler.go` - è·å–æœ€è¿‘æ€ªç‰©å¤„ç† âœ…
    - `pickup_handler.go` - æ‹¾å–æ‰è½ç‰©å¤„ç† âœ…
    - `helpers.go` - åœºæ™¯å¹¿æ’­/å›æ»šå·¥å…· âœ…
  - `internel/movement/manager.go` - ç§»åŠ¨çŠ¶æ€æœº/é€Ÿåº¦æ ¡éªŒ âœ…
  - `internel/entityhelper/` - å®ä½“è¾…åŠ©å·¥å…·
    - `attr.go` - å®ä½“å±æ€§æ‰“åŒ…å·¥å…·ï¼ˆAOI/æŠ€èƒ½ä½¿ç”¨ AttrMap ä¸‹å‘ï¼‰âœ…
    - `entity_snapshot.go` - å®ä½“å¿«ç…§å·¥å…· âœ…
  - `internel/scene/` - åœºæ™¯ç³»ç»Ÿ
    - `scenest.go` - åœºæ™¯å®ç° âœ…

### Actor è°ƒåº¦æ¡†æ¶
- `server/internal/actor/actor_context.go` - Actorä¸»å¾ªç¯ï¼Œè´Ÿè´£æ¶ˆæ¯æ”¶å‘ä¸ `Loop()` è°ƒç”¨
- `server/internal/actor/actor_handler.go` - åè®®åˆ†å‘è¡¨ï¼Œä¿è¯å•åç¨‹æ‰§è¡Œ
- `server/service/dungeonserver/internel/dungeonactor/adapter.go` - å°† `Loop()` ä¸ `entitymgr.RunOne()` å¯¹æ¥

### æµ‹è¯•ä¸å·¥å…·
- `server/example/` - ç¤ºä¾‹å®¢æˆ·ç«¯
  - `client.go` - é›†æˆæµ‹è¯•å…¥å£ï¼ˆæ³¨å†Œ/å»ºè§’/è¿›å‰¯æœ¬/äº’æ”»ï¼‰âœ…
  - `scenario.go` - A/Bç©å®¶å®Œæ•´æµ‹è¯•è„šæœ¬ âœ…
  - `game_client.go` - å®¢æˆ·ç«¯å°è£…ï¼ˆæ³¨å†Œã€å»ºè§’ã€AOIã€æˆ˜æ–—ï¼‰âœ…
  - `client_handler.go` - è®¢é˜… AOI/æŠ€èƒ½å¹¿æ’­å¹¶æ¡¥æ¥åˆ° `GameClient` âœ…

---

## ğŸ”§ å¼€å‘æ³¨æ„äº‹é¡¹

### æ¶æ„åŸåˆ™

1. **GameServer**: ä½¿ç”¨ä¸€ä¸ªç©å®¶ä¸€ä¸ªActoræ¨¡å‹ï¼Œå¤„ç†éå‰¯æœ¬ä¸šåŠ¡
   - èƒŒåŒ…ã€è£…å¤‡ã€ä»»åŠ¡ã€å•†åº—ç­‰
   - æ‰€æœ‰æ“ä½œåœ¨ç©å®¶è‡ªå·±çš„Actorä¸­æ‰§è¡Œï¼Œæ— é”åŒ–
   - ç³»ç»Ÿæ•°æ®ç»Ÿä¸€å­˜å‚¨åœ¨`PlayerRoleBinaryData`ä¸­

2. **DungeonServer**: ä½¿ç”¨å•Actoræ¨¡å‹ï¼Œå¤„ç†å‰¯æœ¬ä¸šåŠ¡
   - æˆ˜æ–—ã€ç§»åŠ¨ã€æŠ€èƒ½é‡Šæ”¾ç­‰
   - æ‰€æœ‰æ“ä½œåœ¨å•Actorä¸­é¡ºåºæ‰§è¡Œï¼Œæ— é”åŒ–
   - æ‰€æœ‰AI/Buff/çŠ¶æ€æ¨è¿›å¿…é¡»æ”¾åœ¨ `entity.RunOne()` å†…æ‰§è¡Œï¼Œç¦æ­¢å†å¯é¢å¤–åç¨‹

3. **æ•°æ®æŒä¹…åŒ–**: 
   - æ‰€æœ‰ç©å®¶ç³»ç»Ÿæ•°æ®ç»Ÿä¸€å­˜å‚¨åœ¨`Player.BinaryData`å­—æ®µä¸­ï¼ˆprotobufåºåˆ—åŒ–çš„`PlayerRoleBinaryData`ï¼‰
   - ç³»ç»Ÿåˆå§‹åŒ–æ—¶ä»`Player.BinaryData`åŠ è½½æ•°æ®ï¼Œç™»å‡ºæ—¶ç»Ÿä¸€ä¿å­˜
   - å¯é€šè¿‡`SaveToDB()`æ–¹æ³•ç«‹å³ä¿å­˜æ•°æ®

4. **é…ç½®é©±åŠ¨**: æ¸¸æˆæ•°æ®é€šè¿‡JSONé…ç½®è¡¨ç®¡ç†
   - ç‰©å“ã€æŠ€èƒ½ã€æ€ªç‰©ç­‰é…ç½®
   - æ”¯æŒçƒ­åŠ è½½ï¼ˆConfigManager.Reload()ï¼‰

5. **æ•°æ®ä¸€è‡´æ€§**: 
   - ç³»ç»Ÿå¿…é¡»ç›´æ¥ä½¿ç”¨`PlayerRoleBinaryData`ä¸­çš„æ•°æ®ï¼Œä¸è¦ç»´æŠ¤é¢å¤–çš„ç´¢å¼•ç»“æ„ï¼ˆå¦‚mapï¼‰
   - å¦‚éœ€å¿«é€ŸæŸ¥æ‰¾ï¼Œä½¿ç”¨è¾…åŠ©å‡½æ•°ä»åŸå§‹æ•°æ®ä¸­æŸ¥æ‰¾
   - é¿å…ç´¢å¼•ä¸æ•°æ®ä¸ä¸€è‡´å¯¼è‡´ä¸šåŠ¡é”™è¯¯

6. **å¼‚æ­¥RPCæ¶æ„**ï¼ˆé‡è¦æ¶æ„å†³ç­–ï¼‰:
   - **åŸåˆ™**: æ‰€æœ‰DungeonServer â†” GameServerä¹‹é—´çš„RPCè°ƒç”¨å¿…é¡»ä½¿ç”¨å¼‚æ­¥æ–¹å¼ï¼Œä¸¥ç¦ä½¿ç”¨åŒæ­¥RPCï¼ˆ`SyncCall`ï¼‰ï¼Œé¿å…é˜»å¡Actoræ¨¡å‹
   - **DungeonServer â†’ GameServer**: ä½¿ç”¨`CallGameServer()`å¼‚æ­¥å‘é€RPCè¯·æ±‚ï¼Œä¸ç­‰å¾…å“åº”
   - **GameServerå¤„ç†**: RPCè¯·æ±‚åœ¨PlayerRoleçš„Actorä¸­å¼‚æ­¥å¤„ç†
   - **DungeonServerå“åº”å¤„ç†**: æ”¶åˆ°å“åº”åï¼Œé€šè¿‡SessionIdè·¯ç”±åˆ°Actorç³»ç»Ÿ

7. **æ‰è½ç‰©å®ä½“è®¾è®¡**ï¼ˆé‡è¦æ¶æ„å†³ç­–ï¼‰:
   - æ‰è½ç‰©ä¸è°ƒç”¨`BaseEntity.RunOne`ï¼Œå› ä¸ºä¸éœ€è¦Buffã€çŠ¶æ€æœºã€ç§»åŠ¨ç³»ç»Ÿ
   - åªéœ€è¦æ£€æŸ¥è¶…æ—¶å¹¶è‡ªåŠ¨ç§»é™¤
   - ç§»é™¤æ—¶å¿…é¡»æ­£ç¡®æ¸…ç†åœºæ™¯ç»‘å®šï¼ˆ`UnbindScene`ï¼‰

8. **é™æ—¶å‰¯æœ¬ç³»ç»Ÿè®¾è®¡**ï¼ˆé‡è¦æ¶æ„å†³ç­–ï¼‰:
   - é™æ—¶å‰¯æœ¬ä¸é»˜è®¤å‰¯æœ¬åˆ†ç¦»ï¼Œæ¯ä¸ªç©å®¶å¯ä»¥æ‹¥æœ‰ç‹¬ç«‹çš„é™æ—¶å‰¯æœ¬å®ä¾‹
   - é€šè¿‡`CreateTimedFuBenForPlayer`ä¸ºç©å®¶åˆ›å»ºé™æ—¶å‰¯æœ¬ï¼Œä½¿ç”¨`sessionId`ä½œä¸ºkey
   - é™æ—¶å‰¯æœ¬é»˜è®¤1åˆ†é’Ÿï¼Œåœ¨`RunOne`ä¸­æ£€æŸ¥è¿‡æœŸå¹¶æ ‡è®°ä¸ºClosingçŠ¶æ€

### å¼€å‘è§„èŒƒ

1. **é”™è¯¯å¤„ç†**: ä½¿ç”¨ `customerr` åŒ…å¤„ç†é”™è¯¯
2. **æ—¥å¿—è®°å½•**: ä½¿ç”¨ `log` åŒ…è®°å½•æ—¥å¿—
3. **äº‹ä»¶å‘å¸ƒ**: é€šè¿‡ `PlayerRole.Publish()` å‘å¸ƒç©å®¶äº‹ä»¶
4. **åè®®å®šä¹‰**: ä¿®æ”¹protoæ–‡ä»¶åéœ€è¦è¿è¡Œè„šæœ¬é‡æ–°ç”Ÿæˆä»£ç 
   ```bash
   cd /c/bgg/postapocgame/proto
   bash genproto.sh
   ```
5. **æšä¸¾å®šä¹‰**: æ‰€æœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±äº«çš„æšä¸¾éƒ½åº”è¯¥å®šä¹‰åœ¨protoåè®®ä¸­ï¼Œé€šè¿‡å·¥å…·ä¸€é”®ç”Ÿæˆï¼Œé¿å…é‡å¤å®šä¹‰
6. **äº‹åŠ¡å¤„ç†**: æ¶‰åŠå¤šä¸ªæ•°æ®æ“ä½œçš„ä¸šåŠ¡ï¼ˆå¦‚æ¶ˆè€—ã€å¥–åŠ±ï¼‰å¿…é¡»ä½¿ç”¨äº‹åŠ¡ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
7. **ç³»ç»Ÿæ— é”åŒ–**: æ‰€æœ‰GameServerç³»ç»Ÿéƒ½ä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºæ¯ä¸ªç³»ç»Ÿåªè¢«å½“å‰è§’è‰²çš„Actorä½¿ç”¨
8. **ç³»ç»Ÿä¸²è¡Œæ‰§è¡Œ**: ç³»ç»Ÿå›è°ƒï¼ˆå¦‚`OnRoleLogin`ã€`OnRoleReconnect`ï¼‰å¿…é¡»åœ¨Actorä¸­ä¸²è¡Œæ‰§è¡Œï¼Œ`SysMgr.EachOpenSystem`å·²æ”¹ä¸ºä¸²è¡Œæ‰§è¡Œï¼Œä¸å†åˆ›å»ºæ–°åç¨‹
9. **æ•°æ®æŒä¹…åŒ–**: å¯ä»¥é€šè¿‡`SaveToDB()`æ–¹æ³•ç«‹å³ä¿å­˜ç©å®¶æ•°æ®åˆ°æ•°æ®åº“ï¼Œä¸é™äºç™»å‡ºæ—¶ä¿å­˜
10. **ç™¾åˆ†æ¯”è®¡ç®—**: æ‰€æœ‰ç™¾åˆ†æ¯”è®¡ç®—ç»Ÿä¸€ä½¿ç”¨ä¸‡åˆ†æ¯”ï¼ˆé™¤ä»¥10000ï¼‰ï¼Œå…ˆæ‰©å¤§å†ç¼©å°ï¼Œé¡¹ç›®ä¸­å°½å¯èƒ½ä¸ä½¿ç”¨float
11. **RunOne()ä½¿ç”¨**: èƒ½æ”¾åœ¨RunOne()é‡Œæ‰§è¡Œçš„éƒ½æ”¾é‡Œé¢ï¼Œæ¶‰åŠåˆ°ç™¾åˆ†æ¯”è®¡ç®—çš„ï¼Œç»Ÿä¸€ä½¿ç”¨ä¸‡åˆ†æ¯”
12. **åŠ é”åŸåˆ™**: å¼€å‘å‰æŒæ¡æœåŠ¡å™¨æ¶æ„ï¼Œé¿å…å¼€å‘æ—¶ä½¿ç”¨é”™è¯¯çš„æŠ€æœ¯ï¼Œå°¤å…¶è¦æ³¨æ„æ˜¯å¦è¦åŠ é”ï¼ï¼ï¼GameServerå’ŒDungeonServeréƒ½éµå¾ªå•Actoræ¨¡å‹ï¼Œä¸éœ€è¦åŠ é”

### é‡è¦è®¾è®¡åŸåˆ™

1. **å±æ€§åŠ¨æ€è®¡ç®—**: å±æ€§éƒ½æ˜¯åŠ¨æ€è®¡ç®—çš„ï¼Œä¸èƒ½å›ºå®šå­˜å‚¨ã€‚å¦‚æœå›ºå®šå­˜å‚¨è€Œä¸æ˜¯æ¯æ¬¡éƒ½åŠ¨æ€è®¡ç®—ï¼Œè°ƒæ•´äº†å±æ€§æ•°å€¼æ— æ³•åŠæ—¶æ›´æ–°æœ€æ–°çš„å±æ€§å€¼
2. **ä½¿ç”¨AttrSt**: ä½¿ç”¨`proto/csproto/base.proto`ä¸­çš„`AttrSt`ç»“æ„ï¼ˆ`uint32 type, int64 value`ï¼‰
3. **å¢é‡æ›´æ–°**: é¦–æ¬¡ç™»å½•è®¡ç®—æ‰€æœ‰å±æ€§ï¼Œåç»­åªè®¡ç®—å˜åŠ¨çš„ç³»ç»Ÿå±æ€§ï¼Œå¢é‡åŒæ­¥åˆ°DungeonServer
4. **å±æ€§ç³»ç»Ÿæšä¸¾**: åœ¨`attr_def.proto`ä¸­å®šä¹‰`SaAttrSys`æšä¸¾ï¼Œæ¯ä¸ªæœ‰å±æ€§çš„ç³»ç»Ÿéƒ½éœ€è¦æ³¨å†Œ
5. **å±æ€§æ±‡æ€»æœºåˆ¶**: `attr_sys`è®°å½•`saAttrSysId â†’ attrData`çš„æ•°æ®ï¼Œé¦–æ¬¡åŒæ­¥æ‰€æœ‰ç³»ç»Ÿï¼Œåç»­åªåŒæ­¥å˜åŠ¨çš„ç³»ç»Ÿ
6. **DungeonServerå±æ€§æ›´æ–°**: DungeonServerçš„è§’è‰²å®ä½“å±æ€§æ›´æ–°æ˜¯å¯¹æ¯”æ”¶åˆ°åè®®å‰åæ€»çš„`attrData`çš„å·®å¼‚ï¼Œå¾—åˆ°ä¸€ä»½åŠ å±æ€§æ•°ç»„ï¼Œä¸€ä»½å‡å±æ€§æ•°ç»„ï¼Œç„¶åè¿›è¡Œå¢åŠ å’Œå‡å°‘å±æ€§

### ä»»åŠ¡ç³»ç»Ÿé…ç½®æ ¼å¼

- ä»»åŠ¡é…ç½®ä½¿ç”¨`targets`æ•°ç»„ï¼Œæ ¼å¼ä¸º`[type, ids, count]`
- `type`: ä»»åŠ¡ç±»å‹ï¼ˆ1=å’ŒNPCå¯¹è¯ï¼Œ2=å­¦ä¹ ä»»æ„æŠ€èƒ½ï¼Œ3=å‡»æ€ä»»æ„æ€ªç‰©ï¼‰ï¼Œå®šä¹‰åœ¨`quest_def.proto`çš„`QuestType`æšä¸¾ä¸­
- `ids`: æ¡ä»¶æ•°ç»„ï¼Œæ˜¯ä¸€ä¸ªæ•´å½¢æ•°ç»„
  - å¯¹äºtype=1ï¼ˆå’ŒNPCå¯¹è¯ï¼‰ï¼Œidsé…ç½®npcIdæ•°ç»„
  - å¯¹äºtype=2ï¼ˆå­¦ä¹ ä»»æ„æŠ€èƒ½ï¼‰å’Œtype=3ï¼ˆå‡»æ€ä»»æ„æ€ªç‰©ï¼‰ï¼Œidså¯ä»¥ä¸ºç©ºæ•°ç»„
- `count`: è¾¾æ ‡æ•°é‡
- ä»»åŠ¡è¿›åº¦æ›´æ–°ï¼š
  - ä½¿ç”¨`UpdateQuestProgress()`æ–¹æ³•æŒ‰ç›®æ ‡ç´¢å¼•æ›´æ–°è¿›åº¦
  - ä½¿ç”¨`UpdateQuestProgressByType()`æ–¹æ³•æ ¹æ®ä»»åŠ¡ç±»å‹è‡ªåŠ¨æ›´æ–°è¿›åº¦ï¼ˆæ¨èï¼Œä¼šè‡ªåŠ¨åŒ¹é…ç¬¦åˆæ¡ä»¶çš„ä»»åŠ¡ç›®æ ‡ï¼‰

### ItemConfigè®¾è®¡åŸåˆ™

- ItemConfigåº”è¯¥ä¿æŒå¹²å‡€ï¼ŒåªåŒ…å«é“å…·çš„åŸºç¡€ä¿¡æ¯ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘ç›¸å…³å­—æ®µ
- ä¸šåŠ¡ç›¸å…³é…ç½®åº”è¯¥åˆ†ç¦»åˆ°ç‹¬ç«‹çš„é…ç½®è¡¨ä¸­ï¼ˆå¦‚è£…å¤‡å¼ºåŒ–é…ç½®ã€æŠ€èƒ½é…ç½®ç­‰ï¼‰
- SubTypeçš„è¯­ä¹‰æ ¹æ®Typeç¡®å®šï¼š
  - `ItemTypeMoney` â†’ `SubType`è¡¨ç¤º`MoneyType`ï¼ˆå¦‚`MoneyTypeExp`ã€`MoneyTypeGoldCoin`ï¼‰
  - `ItemTypeEquipment` â†’ `SubType`è¡¨ç¤º`EquipSlot`ï¼ˆå¦‚`EquipSlotWeapon`ã€`EquipSlotHelmet`ï¼‰
- æ‰€æœ‰æšä¸¾å®šä¹‰åº”è¯¥åœ¨protoåè®®ä¸­ï¼Œä¾¿äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±äº«

### è´§å¸ç³»ç»Ÿè®¾è®¡

- ç»éªŒå€¼ä½œä¸ºè´§å¸ç±»å‹ä¹‹ä¸€ï¼Œç»Ÿä¸€ç”±è´§å¸ç³»ç»Ÿç®¡ç†
- é€šç”¨è´§å¸ï¼ˆå¦‚é‡‘å¸ï¼‰ç”±`MoneySys`ç›´æ¥å¤„ç†
- ç‰¹æ®Šè´§å¸ï¼ˆå¦‚ç»éªŒï¼‰é€šè¿‡`AddMoney()`è‡ªåŠ¨è·¯ç”±åˆ°å¯¹åº”ç³»ç»Ÿï¼ˆ`LevelSys`ï¼‰å¤„ç†
- ç¡®ä¿ç»éªŒå€¼å’Œè´§å¸å€¼çš„ä¸€è‡´æ€§ï¼Œ`LevelSys`çš„ç»éªŒå€¼è‡ªåŠ¨åŒæ­¥åˆ°`MoneySys`çš„`MoneyMap[MoneyTypeExp]`

### ç­‰çº§å±æ€§è¡¨ç³»ç»Ÿè®¾è®¡

- å®šä¹‰äº†é€šç”¨çš„å±æ€§ç»“æ„`Attr`ï¼ˆåŒ…å«`Type`å’Œ`Value`ï¼‰å’Œ`AttrVec`ï¼ˆå±æ€§åˆ—è¡¨ï¼‰
- ç­‰çº§å±æ€§è¡¨ç»Ÿä¸€ç®¡ç†ï¼Œæ¯çº§æä¾›å±æ€§ï¼Œé«˜ç­‰çº§è¦†ç›–ä½ç­‰çº§åŒåå±æ€§
- æ€ªç‰©å’Œç©å®¶å…±ç”¨ä¸€ä»½ç­‰çº§å±æ€§è¡¨ï¼Œé€šè¿‡`ConfigManager.GetLevelAttrs()`è·å–
- å®ä½“åˆå§‹åŒ–æ—¶å…ˆåº”ç”¨ç­‰çº§å±æ€§ï¼Œç„¶ååº”ç”¨ç‰¹å®šé…ç½®ï¼ˆå¦‚æ€ªç‰©é…ç½®ä¸­çš„HP/MPç­‰ï¼‰
- æ‰€æœ‰å±æ€§å€¼éƒ½ä»é…ç½®è¡¨è¯»å–ï¼Œä¸å†ç¡¬ç¼–ç 

### é‚®ä»¶ç³»ç»Ÿåº”ç”¨åœºæ™¯

- **èƒŒåŒ…æ»¡æ—¶è‡ªåŠ¨å‘æ”¾**: `GrantRewards()`æ–¹æ³•å·²æ”¯æŒï¼Œå½“èƒŒåŒ…æ»¡æ—¶è‡ªåŠ¨é€šè¿‡é‚®ä»¶å‘æ”¾å¥–åŠ±
- **ä¸šåŠ¡åœºæ™¯è§¦å‘**: å¦‚ç©å®¶é¦–æ¬¡è¾¾åˆ°10çº§ï¼Œé€šè¿‡é‚®ä»¶ä¸‹å‘æ–°è£…å¤‡ï¼ˆä½¿ç”¨`GMSys.SendSystemMail`ï¼‰
- **ç³»ç»Ÿé€šçŸ¥**: å¦‚æœåŠ¡å™¨æ›´æ–°é€šçŸ¥ï¼ˆä½¿ç”¨`GMSys.SendSystemNotification`ï¼‰
- **ç³»ç»Ÿè¡¥å‘å¥–åŠ±**: å¦‚æœåŠ¡å™¨ç»´æŠ¤è¡¥å¿ï¼ˆä½¿ç”¨`GMSys.GrantRewardsByMail`ï¼‰

### GMç³»ç»Ÿä½¿ç”¨

- GMç³»ç»Ÿæ˜¯å•ä¾‹ï¼Œä¸éœ€è¦æ³¨å†Œä¸ºç©å®¶ç³»ç»Ÿï¼Œé€šè¿‡`GetGMSys()`è·å–å®ä¾‹
- æ”¯æŒå‘é€ç³»ç»Ÿé€šçŸ¥å’Œç³»ç»Ÿé‚®ä»¶ç»™æŒ‡å®šç©å®¶æˆ–æ‰€æœ‰åœ¨çº¿ç©å®¶
- æ”¯æŒä½¿ç”¨é‚®ä»¶æ¨¡æ¿å‘é€ç³»ç»Ÿé‚®ä»¶
- æ”¯æŒé€šè¿‡é‚®ä»¶å‘æ”¾å¥–åŠ±ï¼ˆç”¨äºè¡¥å‘å¥–åŠ±ç­‰åœºæ™¯ï¼‰

### GMå‘½ä»¤ç³»ç»Ÿä½¿ç”¨

- GMå‘½ä»¤ç®¡ç†å™¨æ˜¯å•ä¾‹ï¼Œé€šè¿‡`GetGMManager()`è·å–å®ä¾‹
- ä½¿ç”¨`RegisterCommand()`æ³¨å†Œè‡ªå®šä¹‰GMå‘½ä»¤
- GMå‘½ä»¤å‡½æ•°ç­¾åï¼š`func(playerRole IPlayerRole, args ...string) bool`
- æ¯ä¸ªGMå‘½ä»¤éœ€è¦æŒ‡å®šæ‰€éœ€GMç­‰çº§ï¼ˆ0=æ™®é€šç©å®¶ 1=GM 2=é«˜çº§GM 3=è¶…çº§GMï¼‰
- å®¢æˆ·ç«¯é€šè¿‡`C2SGMCommand`åè®®å‘é€GMå‘½ä»¤ï¼ŒæœåŠ¡å™¨é€šè¿‡`S2CGMCommandResult`è¿”å›æ‰§è¡Œç»“æœ
- ç©å®¶GMç­‰çº§å­˜å‚¨åœ¨`PlayerSimpleData.gm_level`å­—æ®µä¸­

---

## ğŸ“‹ å¼€å‘ä¼˜å…ˆçº§æ€»ç»“

### ğŸ”¥ ç´§æ€¥ï¼ˆå¿…é¡»å°½å¿«å®Œæˆï¼‰
1. âœ… GameServerå±æ€§ç³»ç»Ÿæ±‡æ€»æ¶æ„ï¼ˆå·²å®Œæˆï¼‰- **æœ€é«˜ä¼˜å…ˆçº§**
2. âœ… è§’è‰²è¿›å…¥æ¸¸æˆæµç¨‹å®Œå–„ï¼ˆå·²å®Œæˆï¼‰- **æœ€é«˜ä¼˜å…ˆçº§**
3. âœ… é…ç½®ç³»ç»Ÿæ‰©å±•ï¼ˆå·²å®Œæˆï¼‰- **é«˜ä¼˜å…ˆçº§**

### â­ é‡è¦ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
4. âœ… ç‰©å“ä½¿ç”¨ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰- æˆ˜æ–—å¾ªç¯çš„æ ¸å¿ƒ
5. âœ… è£…å¤‡å›æ”¶/åˆ†è§£ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰- ç»æµå¾ªç¯çš„å…³é”®
6. âœ… NPCå¯¹è¯ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰
7. âœ… æŠ€èƒ½å­¦ä¹ ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰
8. âœ… æŠ€èƒ½å‡çº§ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰- å…»æˆæ ¸å¿ƒ
9. âœ… åœºæ™¯åˆ‡æ¢ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰
10. âœ… æ‰è½ç‰©ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰- åŒ…å«å­˜åœ¨æ—¶é—´ç®¡ç†ã€å¼‚æ­¥RPCå®ç°
11. âœ… é™æ—¶å‰¯æœ¬ç³»ç»Ÿå®Œå–„ï¼ˆå·²å®Œæˆï¼‰

### ğŸ“Œ ä¸­ä¼˜å…ˆçº§ï¼ˆåŠŸèƒ½ä¼˜åŒ–ï¼‰
12. âœ… é˜²ä½œå¼Šæœºåˆ¶ï¼ˆåŸºç¡€æ¡†æ¶å·²å®Œæˆï¼‰- æ¸¸æˆå®‰å…¨çš„åŸºç¡€ï¼ˆéƒ¨åˆ†åŠŸèƒ½å¾…å®Œå–„ï¼‰
13. âœ… ç¦»çº¿æ”¶ç›Šç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰- æå‡ç•™å­˜
14. âœ… æ¯æ—¥ä»»åŠ¡/æ´»åŠ¨ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰- å¢åŠ æ¸¸æˆç²˜æ€§
15. âœ… æˆå°±ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰- æä¾›é•¿æœŸç›®æ ‡
16. âœ… æ–°æ‰‹ä¿æŠ¤æœºåˆ¶ï¼ˆå·²å®Œæˆï¼‰- ä¿æŠ¤æ–°æ‰‹ç©å®¶
17. âš ï¸ æ•°æ®ç»Ÿè®¡ä¸åˆ†æï¼ˆå¾…å®ç°ï¼‰- äº†è§£ç©å®¶è¡Œä¸ºï¼Œä¼˜åŒ–æ¸¸æˆè®¾è®¡
18. âœ… è§’è‰²æ­»äº¡å¤æ´»ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰
19. âœ… è·å–æœ€è¿‘æ€ªç‰©ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰
20. âœ… ç§»åŠ¨åæ ‡åŒæ­¥åˆ°GameServerï¼ˆå·²å®Œæˆï¼‰
21. âœ… è£…å¤‡ç³»ç»ŸåŠŸèƒ½æ‰©å±•ï¼ˆå·²å®Œæˆï¼‰- ç²¾ç‚¼/é™„é­”/å¥—è£…æ•ˆæœå·²å®ç°
22. âœ… ä»»åŠ¡ç³»ç»ŸåŠŸèƒ½æ‰©å±•ï¼ˆå·²å®Œæˆï¼‰- ä»»åŠ¡é“¾ã€æ—¥å¸¸/å‘¨å¸¸ä»»åŠ¡
23. âœ… é‚®ä»¶ç³»ç»ŸåŠŸèƒ½æ‰©å±•ï¼ˆå·²å®Œæˆï¼‰- æ‰¹é‡æ“ä½œã€åˆ†ç±»ã€æœç´¢

### ğŸ¯ ä½ä¼˜å…ˆçº§ï¼ˆåŠŸèƒ½å®Œå–„ï¼‰
24. åŠ¨ç”»åŒæ­¥åè®®
25. æˆ˜æ–—å½•åƒåŠŸèƒ½
26. å‰¯æœ¬åŒ¹é…/æ’é˜Ÿç³»ç»Ÿ
27. Bossæˆ˜ç‰¹æ®Šæœºåˆ¶

### ğŸ”® åç»­ï¼ˆæ‰©å±•åŠŸèƒ½ï¼‰
28-34. Phase 3 å’Œ Phase 4 åŠŸèƒ½

---

## ğŸ’¡ å¼€å‘å»ºè®®

### å¼€å‘é¡ºåºå»ºè®®
1. **å…ˆå®Œæˆä¼˜å…ˆçº§1ï¼ˆæ ¸å¿ƒæ¶æ„å®ç°ï¼‰**ï¼šè¿™æ˜¯æ¸¸æˆæµç¨‹çš„åŸºç¡€ï¼Œå¿…é¡»ä¼˜å…ˆå®Œæˆ
2. **å†å®ç°ä¼˜å…ˆçº§2ï¼ˆæ¸¸æˆæµç¨‹æ ¸å¿ƒåŠŸèƒ½ï¼‰**ï¼šè¿™äº›æ˜¯æ ¸å¿ƒç©æ³•ï¼Œå¿…é¡»å®ç°æ‰èƒ½æ­£å¸¸æ¸¸æˆ
3. **ç„¶åå®ç°ä¼˜å…ˆçº§3ï¼ˆç³»ç»ŸåŠŸèƒ½ä¼˜åŒ–ï¼‰**ï¼šä¼˜åŒ–å·²æœ‰ç³»ç»Ÿï¼Œæå‡æ¸¸æˆä½“éªŒ
4. **æœ€åå®ç°ä¼˜å…ˆçº§4-7**ï¼šæ ¹æ®é¡¹ç›®è¿›åº¦å’Œéœ€æ±‚ï¼Œé€æ­¥å®ç°å…¶ä»–åŠŸèƒ½

### å¼€å‘æ³¨æ„äº‹é¡¹
- æ¯æ¬¡å®Œæˆæ–°åŠŸèƒ½åï¼Œæ›´æ–°æ–‡æ¡£çš„"å·²å®ŒæˆåŠŸèƒ½"éƒ¨åˆ†
- é‡åˆ°é‡è¦æ¶æ„å†³ç­–æ—¶ï¼Œåœ¨"å¼€å‘æ³¨æ„äº‹é¡¹"ä¸­è®°å½•
- å‘ç°æ–°çš„å…³é”®ä»£ç ä½ç½®æ—¶ï¼Œè¡¥å……åˆ°"å…³é”®ä»£ç ä½ç½®"éƒ¨åˆ†
- ä»£ç ä¸­çš„TODOæ³¨é‡Šè¦åŠæ—¶å¤„ç†ï¼Œä¸è¦ç§¯ç´¯
- å‚è€ƒå·²å®Œæˆç³»ç»Ÿçš„å®ç°æ–¹å¼ï¼Œä¿æŒä»£ç é£æ ¼ä¸€è‡´
- **å¼€å‘å‰æŒæ¡æœåŠ¡å™¨æ¶æ„ï¼Œé¿å…å¼€å‘æ—¶ä½¿ç”¨é”™è¯¯çš„æŠ€æœ¯ï¼Œå°¤å…¶è¦æ³¨æ„æ˜¯å¦è¦åŠ é”ï¼ï¼ï¼**
- **èƒ½æ”¾åœ¨RunOne()é‡Œæ‰§è¡Œçš„éƒ½æ”¾é‡Œé¢**
- **æ¶‰åŠåˆ°ç™¾åˆ†æ¯”è®¡ç®—çš„ï¼Œç»Ÿä¸€ä½¿ç”¨ä¸‡åˆ†æ¯”ï¼Œå…ˆæ‰©å¤§å†ç¼©å°ï¼Œé¡¹ç›®ä¸­å°½å¯èƒ½ä¸ä½¿ç”¨float**

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- `docs/æœåŠ¡å™¨è§„åˆ’.md` - æœåŠ¡å™¨è§„åˆ’æ–‡æ¡£
- `server/README.md` - æœåŠ¡å™¨æ¶æ„è¯´æ˜

---

## ğŸ’¡ æç¤º

ä¸‹æ¬¡ç»§ç»­å¼€å‘æ—¶ï¼Œåªéœ€è¦æä¾›è¿™ä»½æ–‡æ¡£ï¼Œå¼€å‘è€…å°±èƒ½å¿«é€Ÿäº†è§£ï¼š
- é¡¹ç›®å½“å‰çŠ¶æ€
- å·²å®ŒæˆåŠŸèƒ½
- å¾…å®ç°åŠŸèƒ½
- å…³é”®ä»£ç ä½ç½®
- å¼€å‘æ³¨æ„äº‹é¡¹

**å»ºè®®**: æ¯æ¬¡å®Œæˆæ–°åŠŸèƒ½åï¼Œæ›´æ–°æ­¤æ–‡æ¡£çš„"å·²å®ŒæˆåŠŸèƒ½"éƒ¨åˆ†ã€‚
