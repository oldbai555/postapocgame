## 0. 开发必读
- 权威设计文档：`docs/vue3实现方案.md`、`docs/fullstack_prompt.md`。遵循 Page → Component → Store → API → Backend 分层，generated 代码禁止手改。
- goctl 前后端协同：使用 `pnpm api:gen` 或直接执行 goctl 生成 TS（输出到 `src/api/generated/`），业务封装写在 `src/api/*.ts`。
- **开发流程规范（强制遵守）**：
  1. **先开发后端**：等待后端完成 API 定义和实现，确保后端接口可独立测试通过
  2. **再开发前端**：基于后端接口，使用 goctl 生成 TS 代码，实现前端页面和组件
  3. **最后联调**：前后端联调接口，测试完整流程，确保功能正常
  4. **测试通过后再开发下一个功能**：每个功能必须完整实现并测试通过后，才能开始下一个功能的开发
- **通用组件使用规范**：
  - **D2Table 组件**（`src/components/common/D2Table.vue`）：适用于所有涉及表格展示、分页、详情/编辑、新增的业务页面
    - 功能：统一的表格展示、分页、内置详情/编辑抽屉、内置新增抽屉、支持多种列类型
    - 使用场景：列表管理页面（如角色管理、权限管理、用户管理等）
    - 参考示例：`src/views/system/RoleList.vue`、`src/views/system/PermissionList.vue`、`src/views/system/UserList.vue`
    - 组件文档：`src/components/common/README.md`
    - 类型定义：`src/types/table.ts`
  - **el-tree 组件**：适用于树形数据展示（如部门管理、菜单管理）
    - 参考示例：`src/views/system/DepartmentList.vue`、`src/views/system/MenuList.vue`

---

## 1. 已完成功能
- 初始化 admin-frontend（Vite + Vue3 + TS + Pinia + Vue Router + Element Plus），内置登录页、基础布局、菜单导航。
- 封装 Axios 请求与 Token 拦截（`src/utils/request.ts`），Pinia 用户状态与登录/登出（`src/stores/user.ts`）。
- 角色管理页面：列表查询、分页、新增、编辑、删除，对接 `/api/v1/roles`。
- 权限管理页面：列表查询、分页、新增、编辑、删除，对接 `/api/v1/permissions`。
- 部门管理页面：部门树展示、新增/编辑/删除，对接 `/api/v1/departments/tree` 等接口。
- 菜单管理页面：菜单树展示、新增/编辑/删除，对接 `/api/v1/menus/tree` 等接口。
- 用户管理页面：列表查询、分页、新增、编辑、删除，对接 `/api/v1/users`。
- goctl TS 生成脚本：`pnpm api:gen`（调用 `scripts/api-gen.mjs` 批量生成后端 .api 的 TS 代码）。
- 按钮级权限指令 `v-permission`，路由级权限校验（meta.permission），菜单/按钮按权限过滤渲染。
- 菜单树拉取 `/api/v1/menus/tree` 并在侧栏展示。
- 主题样式基础变量、403/404 错误页，内置 i18n（zh/en 文案覆盖），主题切换（明亮/暗色）。
- 权限/菜单本地缓存（TTL 5min），登录后自动加载缓存并按需刷新。
- 动态路由注入与 KeepAlive 缓存（菜单路径映射至页面组件，meta.keepAlive 为 true）。

---

## 2. 待实现 / 待完善功能
- [✅] 阶段三：RBAC 权限/组织/菜单管理（用户/角色/权限/部门/菜单/按钮）
  - [✅] 角色管理页面（列表、新增、编辑、删除）
  - [✅] 权限管理页面（列表、新增、编辑、删除）
  - [✅] 部门管理页面（树形展示、新增、编辑、删除）
  - [✅] 菜单管理页面（树形展示、新增、编辑、删除）
  - [✅] 用户管理页面（列表、新增、编辑、删除）
- [ ] 菜单组件路径与后端约定的自动映射策略（当前手工 map）。
- [ ] 主题更多维度（色板、字体），国际化文案进一步细化。
- [ ] 单元测试与 E2E 验证。

---

## 3. 技术决策记录
- 2025-12-24：前端使用 goctl TS 生成 + Axios 二次封装；对生成代码中的 path param 问题在自定义 API 层修正（不修改 generated）。
- 2025-12-24：权限指令 v-permission 基于 Pinia 权限列表与 `permissions.includes('*')`；路由 meta.permission 校验不通过跳转 403。
- 2025-12-24：权限/菜单本地缓存 TTL 5 分钟；动态路由由菜单树驱动并开启 KeepAlive；主题切换通过 `data-theme`。

---

## 4. 关键代码位置
- 入口：`src/main.ts`，路由：`src/router/index.ts`，布局：`src/layouts/DefaultLayout.vue`，登录：`src/views/Login.vue`。
- 状态：`src/stores/user.ts`；请求封装：`src/utils/request.ts`。
- 角色页：`src/views/system/RoleList.vue`；API 封装：`src/api/role.ts`。
- 权限页：`src/views/system/PermissionList.vue`；API 封装：`src/api/permission.ts`。
- 部门页：`src/views/system/DepartmentList.vue`；API 封装：`src/api/department.ts`。
- 菜单页：`src/views/system/MenuList.vue`；API 封装：`src/api/menu.ts`。
- 用户页：`src/views/system/UserList.vue`；API 封装：`src/api/user.ts`。
- goctl 生成目录：`src/api/generated/`；生成脚本：`scripts/api-gen.mjs`。
- 权限指令与钩子：`src/directives/permission.ts`，`src/hooks/usePermission.ts`。
- 菜单 API 与渲染：`src/api/menu.ts`，`src/layouts/DefaultLayout.vue`。
- 错误页：`src/views/error/NoAccess.vue`，`src/views/error/NotFound.vue`。
- 主题与 i18n：`src/styles/theme.scss`，`src/i18n/index.ts`。
- 路由/缓存：`src/router/index.ts`（动态注入 + meta.keepAlive）、`src/App.vue`（KeepAlive 包裹）。

---

## 5. 接口对接进度
- 角色管理：GET/POST/PUT/DELETE `/api/v1/roles` ✅
- 权限管理：GET/POST/PUT/DELETE `/api/v1/permissions` ✅
- 部门管理：GET `/api/v1/departments/tree`，POST/PUT/DELETE `/api/v1/departments/:id` ✅
- 菜单管理：GET `/api/v1/menus/tree`，POST/PUT/DELETE `/api/v1/menus/:id` ✅
- 用户管理：GET/POST/PUT/DELETE `/api/v1/users` ✅
- 认证：POST `/api/v1/auth/login`、POST `/api/v1/auth/logout`、GET `/api/v1/auth/profile` ✅（登录页接入）

